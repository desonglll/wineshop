## 1、类型管理

### 1.1 类型后端接口

### 1.1.1  model层

```
package com.yanzhen.model;

import java.io.Serializable;
import java.util.Date;

public class RoomType implements Serializable {
    private Integer id;
    private String typeName;
    private Double price;
    private String remark;
    private Date createTime;
    private String createAuthor;
    private Date updateTime;
    private String updateAuthor;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getTypeName() {
        return typeName;
    }

    public void setTypeName(String typeName) {
        this.typeName = typeName;
    }

    public Double getPrice() {
        return price;
    }

    public void setPrice(Double price) {
        this.price = price;
    }

    public String getRemark() {
        return remark;
    }

    public void setRemark(String remark) {
        this.remark = remark;
    }

    public Date getCreateTime() {
        return createTime;
    }

    public void setCreateTime(Date createTime) {
        this.createTime = createTime;
    }

    public String getCreateAuthor() {
        return createAuthor;
    }

    public void setCreateAuthor(String createAuthor) {
        this.createAuthor = createAuthor;
    }

    public Date getUpdateTime() {
        return updateTime;
    }

    public void setUpdateTime(Date updateTime) {
        this.updateTime = updateTime;
    }

    public String getUpdateAuthor() {
        return updateAuthor;
    }

    public void setUpdateAuthor(String updateAuthor) {
        this.updateAuthor = updateAuthor;
    }
}

```

### 1.1.2 dao层

编写类型管理增删改查接口

```
package com.yanzhen.dao;

import com.yanzhen.model.RoomType;

import java.sql.SQLException;
import java.util.List;

public interface TypeInfoDao {
    /**
     * 查询房间类型列表
     * @param startPage 起始页
     * @param limit  每页显示的记录数据
     * @param content  高级查询的条件
     * @return
     */
     List<RoomType> queryList(int startPage,int limit,String content) throws SQLException;


    /**
     * 获取总的记录数据
     */
    int getCounts(String content) throws SQLException;

    /**
     * 增加类型
     */
    boolean saveInfo(RoomType type);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    RoomType queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(RoomType type);
}

```

接口实现类

```
package com.yanzhen.dao.impl;


import com.yanzhen.dao.TypeInfoDao;
import com.yanzhen.model.RoomType;
import com.yanzhen.util.DbUtils;
import com.yanzhen.util.JdbcUtil;

import javax.sql.rowset.JdbcRowSet;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

public class TypeInfoDaoImpl implements TypeInfoDao {
    DbUtils dbUtils=new DbUtils();
    @Override
    public List<RoomType> queryList(int startPage, int limit, String content) throws SQLException {
        List<RoomType> list=new ArrayList<RoomType>();
        String sql="select * from room_type where 1=1 ";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append(" and type_name like '"+content+"'");
        }
        sb.append(" limit "+startPage+","+limit);
        ResultSet rs=JdbcUtil.querySql(sb.toString());
        while(rs.next()){
            RoomType type=new RoomType();
            type.setId(rs.getInt("id"));
            type.setTypeName(rs.getString("type_name"));
            type.setPrice(rs.getDouble("price"));
            type.setRemark(rs.getString("remark"));
            type.setCreateTime(rs.getDate("create_time"));
            type.setCreateAuthor(rs.getString("create_author"));
            list.add(type);
        }
        return list;
    }

    @Override
    public int getCounts(String content) throws SQLException {
        String sql="select * from room_type where 1=1 ";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append(" and type_name like '"+content+"'");
        }
        int num=dbUtils.getCount(sb.toString());
        return num;
    }

    @Override
    public boolean saveInfo(RoomType type) {
        String sql="insert into room_type(type_name,price,remark,create_time,create_author) values" +
                " ('"+type.getTypeName()+"',"+type.getPrice()+",'"+type.getRemark()+"'," +
                " '"+type.getCreateTime()+"','"+type.getCreateAuthor()+"')";
        int num= JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(num>0){
            return true;
        }
        return false;
    }

    @Override
    public boolean deleteById(Integer id) {
        String sql="delete from room_type where id="+id;
        int num= JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(num>0){
            return true;
        }
        return false;
    }

    @Override
    public RoomType queryByID(Integer id) throws SQLException {
        String sql="select * from room_type where id="+id;
        ResultSet rs=JdbcUtil.querySql(sql);
        RoomType type=new RoomType();
        if(rs.next()){
            type.setId(rs.getInt("id"));
            type.setTypeName(rs.getString("type_name"));
            type.setPrice(rs.getDouble("price"));
            type.setRemark(rs.getString("remark"));
            type.setCreateTime(rs.getDate("create_time"));
            type.setCreateAuthor(rs.getString("create_author"));
        }
        return type;
    }

    @Override
    public boolean updateInfo(RoomType type) {
        String sql="update room_type set type_name='"+type.getTypeName()+"'," +
                " remark ='"+type.getRemark()+"' where id="+type.getId();
        int num=JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(num>0){
            return true;
        }
        return false;
    }
}

```

### 1.1.3 service方法

 ```
package com.yanzhen.service;

import com.yanzhen.model.RoomType;
import com.yanzhen.util.PageBean;

import java.sql.SQLException;

public interface TypeInfoService {
    /**
     * 分页查询
     */
    PageBean getPage(String page,String limit,String content) throws SQLException;

    /**
     * 增加类型
     */
    boolean saveInfo(RoomType type);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    RoomType queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(RoomType type);
}

 ```

实现层

```
package com.yanzhen.service.impl;

import com.yanzhen.dao.TypeInfoDao;
import com.yanzhen.dao.impl.TypeInfoDaoImpl;
import com.yanzhen.model.RoomType;
import com.yanzhen.service.TypeInfoService;
import com.yanzhen.util.PageBean;

import java.sql.SQLException;
import java.util.List;

public class TypeInfoServiceImpl implements TypeInfoService {
    TypeInfoDao dao=new TypeInfoDaoImpl();
    @Override
    public PageBean getPage(String page, String limit, String content) throws SQLException {
        //引入分页对象
        PageBean<RoomType> pageBean=new PageBean<>();
        //当前页
        Integer page2=Integer.parseInt(page);
        //每页显示记录数
        Integer limit2=Integer.parseInt(limit);
        //起始记录数  类似
        int startPage=(page2-1)*pageBean.getPageCount();
        //总的记录数据
        int counts=dao.getCounts(content);
        //获取list
        List<RoomType> list= dao.queryList(startPage,limit2,content);
        //设置对象
        pageBean.setPageData(list);
        //总的数据
        pageBean.setTotalCount(counts);
        //总的页数
        pageBean.setTotalPage(counts/pageBean.getPageCount()+1);
        return pageBean;
    }

    @Override
    public boolean saveInfo(RoomType type) {
        return dao.saveInfo(type);
    }

    @Override
    public boolean deleteById(Integer id) {
        return dao.deleteById(id);
    }

    @Override
    public RoomType queryByID(Integer id) throws SQLException {
        return dao.queryByID(id);
    }

    @Override
    public boolean updateInfo(RoomType type) {
        return dao.updateInfo(type);
    }
}

```

### 1.1.4 返回封装对象的编写

```
package com.yanzhen.util;

import java.util.List;

public class JsonObject {
   private  Integer code;
   private String msg;
   private Integer count;
   private List data;

    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }

    public String getMsg() {
        return msg;
    }

    public void setMsg(String msg) {
        this.msg = msg;
    }

    public Integer getCount() {
        return count;
    }

    public void setCount(Integer count) {
        this.count = count;
    }

    public List getData() {
        return data;
    }

    public void setData(List data) {
        this.data = data;
    }
}

```

### 1.1.5 controller层查询

```
package com.yanzhen.controller;

import com.alibaba.fastjson.JSON;
import com.yanzhen.model.RoomType;
import com.yanzhen.service.TypeInfoService;
import com.yanzhen.service.impl.TypeInfoServiceImpl;
import com.yanzhen.util.JsonObject;
import com.yanzhen.util.PageBean;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;

@WebServlet("/typeInfoServlet")
public class TypeInfoServlet extends HttpServlet {
    TypeInfoService service=new TypeInfoServiceImpl();
    @Override
    protected void service(HttpServletRequest req,
                           HttpServletResponse resp) throws ServletException, IOException {
        //接收前端的传值  当前页 每页显示记录数
        String currPage=req.getParameter("page");
        String limit=req.getParameter("limit");
        String content=req.getParameter("content")==null?null:req.getParameter("content");
        //判断
        if(currPage==null || "".equals(currPage.trim())){
            currPage="1";
        }

        if(limit==null || "".equals(limit.trim())){
            limit="10";
        }

        //通过service层接口拿到分页对象
        PageBean<RoomType> pageBean=null;
        try {
            pageBean = service.getPage(currPage,limit,content);
        } catch (SQLException throwables) {
            throwables.printStackTrace();
        }

        //转到前端
        JsonObject object=new JsonObject();
        object.setCode(0);
        object.setMsg("");
        object.setCount(pageBean.getTotalCount());
        object.setData(pageBean.getPageData());

        resp.setContentType("application/json;chartset=utf-8");
        String jsons=JSON.toJSONString(object);
        resp.getWriter().print(jsons);

    }
}

```

### 1.1.6 前后端交互

涉及到的代码内容

```
 <table class="layui-table" lay-data="{url:'../typeInfoServlet',page:true,toolbar: '#toolbarDemo',id:'test'}" lay-filter="test">
        <thead>
        <tr>
            <th lay-data="{type:'checkbox'}">ID</th>
            <th lay-data="{field:'id', width:120, sort: true}">ID</th>
            <th lay-data="{field:'typeName', width:200, sort: true}">类型名称</th>
            <th lay-data="{field:'price',  width: 150}">价格</th>
            <th lay-data="{field:'createTime',templet: '#dateTpl'}">创建时间</th>
            <th lay-data="{field:'createAuthor', width: 150}">创建人</th>
            <th lay-data="{fixed: 'right', width:220, align:'center', toolbar: '#barDemo'}">操作</th>
        </tr>
        </thead>
    </table>

</div>

<script type="text/html" id="dateTpl">
   {{ layui.util.toDateString(d.createTime,"yyyy-MM-dd")}}
</script>

```

### 1.1.7 高级查询

高级查询的类型框

```
 <div class="demoTable">
        类型名称：
        <div class="layui-inline">
            <input class="layui-input" name="typeName" id="typeName" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
    </div>
```

事件

```
 var $ = layui.$, active = {
            reload: function(){
                var typeName = $('#typeName');
                //执行重载
                table.reload('test', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                       content: typeName.val()
                    }
                }, 'data');
            }
        };

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
```

### 1.1.8 类型添加页面的设计

```
<%--
  Created by IntelliJ IDEA.
  User: zhouk
  Date: 2022/1/3
  Time: 21:30
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script type="text/javascript" src="./js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <div class="layui-form-item">
            <label for="L_email" class="layui-form-label">
                <span class="x-red">*</span>类型名称
            </label>
            <div class="layui-input-inline">
                <input type="text" id="L_email" name="typeName" required=""
                       autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">
                <span class="x-red">*</span>名称建议唯一
            </div>
        </div>
        <div class="layui-form-item">
            <label for="L_username" class="layui-form-label">
                <span class="x-red">*</span>价格
            </label>
            <div class="layui-input-inline">
                <input type="text" id="L_username" name="price" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="L_pass" class="layui-form-label">
                <span class="x-red">*</span>备注信息
            </label>
            <div class="layui-input-inline">
                <input type="password" id="L_pass" name="remark" required=""
                       autocomplete="off" class="layui-input">
            </div>

        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="add" lay-submit="">
                添加房间类型
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer'], function(){
        $ = layui.jquery;
        var form = layui.form
            ,layer = layui.layer;



        //监听提交
        form.on('submit(add)', function(data){
            /*
               1、获取输入框的值信息
               2、通过ajax请求向后端发送请求
               3、根据响应反馈信息提示，并刷新主页
             */
            var data=data.field;
            $.ajax({
                url:"../typeInfoServlet?flag=insert",
                type:"post",
                data:data,
                success:function(result){
                    if(result.code==0){
                        layer.alert("增加成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("不好意思，添加失败了...")
                    }
                }
            })
            // console.log(data);
            // //发异步，把数据提交给php

            return false;
        });


    });
</script>

</body>

</html>
```

### 1.1.9 添加功能的实现

```
package com.yanzhen.controller;

import com.alibaba.fastjson.JSON;
import com.yanzhen.model.RoomType;
import com.yanzhen.service.TypeInfoService;
import com.yanzhen.service.impl.TypeInfoServiceImpl;
import com.yanzhen.util.JsonObject;
import com.yanzhen.util.PageBean;
import com.yanzhen.util.R;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;
import java.util.Date;

@WebServlet("/typeInfoServlet")
public class TypeInfoServlet extends HttpServlet {
    TypeInfoService service=new TypeInfoServiceImpl();
    @Override
    protected void service(HttpServletRequest req,
                           HttpServletResponse resp) throws ServletException, IOException {
      //接收前端传来的标识，根据标识进行执行代码块
       String flag=req.getParameter("flag")==null?"":req.getParameter("flag");
       switch (flag){
           case "insert":
               //调用添加方法
               //接收前端传过来的值信息
               String name=req.getParameter("typeName");
               String price=req.getParameter("price");
               String remark=req.getParameter("remark");
               RoomType type= new RoomType();
               type.setTypeName(name);
               type.setPrice(Double.parseDouble(price));
               type.setRemark(remark);
               type.setCreateAuthor("admin");//后续改成登录用户
               type.setCreateTime(new Date());
               boolean bs=service.saveInfo(type);
               resp.setContentType("application/json;chartset=utf-8");
               String jsons=JSON.toJSONString(R.fail("添加失败了..."));
               if(bs){
                    jsons=JSON.toJSONString(R.ok());
               }
               resp.getWriter().print(jsons);
               break;
           case "update":
               break;
           default:
               queryList(req,resp);
               break;
       }

    }

    /**
     * 查询方法
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    public void queryList(HttpServletRequest req,
                          HttpServletResponse resp) throws ServletException, IOException {
        //接收前端的传值  当前页 每页显示记录数
        String currPage=req.getParameter("page");
        String limit=req.getParameter("limit");
        String content=req.getParameter("content")==null?null:req.getParameter("content");
        //判断
        if(currPage==null || "".equals(currPage.trim())){
            currPage="1";
        }

        if(limit==null || "".equals(limit.trim())){
            limit="10";
        }

        //通过service层接口拿到分页对象
        PageBean<RoomType> pageBean=null;
        try {
            pageBean = service.getPage(currPage,limit,content);
        } catch (SQLException throwables) {
            throwables.printStackTrace();
        }

        //转到前端
        JsonObject object=new JsonObject();
        object.setCode(0);
        object.setMsg("");
        object.setCount(pageBean.getTotalCount());
        object.setData(pageBean.getPageData());

        resp.setContentType("application/json;chartset=utf-8");
        String jsons=JSON.toJSONString(object);
        resp.getWriter().print(jsons);
    }
}

```



注意点：添加时候时间类型不正确

### 1.1.10 删除功能



#### 1、批量删除

​      流程：

​          1、选择要删除的记录，如果不选择 提示选择记录

​                 如果选择，执行删除功能

​          2、获取要删除的id，传入后端，找到删除接口

​               根据id列表进行删除工作

​          3、返回标识到前端，根据标识提示删除成功与否，如果成功，刷新页面

##### 1,1 监听事件

```
 <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
        <xblock>
            <button class="layui-btn layui-btn-danger" lay-event="getCheckData">批量删除</button>
            <button class="layui-btn" onclick="x_admin_show('添加房间类型','./TypeAdd.jsp',600,400)"><i class="layui-icon"></i>添加</button>
        </xblock>
        </div>
    </script>
```

调用js中的监听事件

```
 //头工具栏事件
        table.on('toolbar(test)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            if(obj.event=='getCheckData'){
                var data = checkStatus.data;
                /**
                 * 如果没有选择提示选择，如果选择获取选中id集合
                 */
                debugger
                if(data.length==0){
                    layer.msg("请选择您要删除的记录信息...")
                }else{
                    //获取id集合，进行删除工作
                    var ids=getCheakIds(data);
                    layer.confirm('您确定要删除记录吗？',function(index){
                       //执行删除工作
                        deleteByIds(ids,index);
                    })
                }

                // layer.alert(JSON.stringify(data));
            }

 /**
             * 根据数据获取选择记录的id集合
             */
            function getCheakIds(data){
                var arr=new Array();
                for(var i=0;i<data.length;i++){
                    arr.push(data[i].id);
                }
                return arr.join(",");
            }

            /**
             * 根据id删除记录信息
             */
            function deleteByIds(ids,index){
                $.ajax({
                    url:"../typeInfoServlet?flag=delete",
                    type:"post",
                    data: {ids:ids},
                    success:function(result){
                        if(result.code==0){
                            layer.alert("删除成功", {icon: 6},function () {
                                parent.window.location.reload();

                            });
                        }else{
                            layer.msg("不好意思，删除失败了...")
                        }
                    }
                })
            }

        });

```

##### 1.2 后端提供接口 

```
 case "delete":
               String ids=req.getParameter("ids");
               //把接收到的字符串转成集合
               List<String> idList= Arrays.asList(ids.split(","));
               for(String id:idList){
                   service.deleteById(Integer.parseInt(id));
               }
               resp.setContentType("application/json;chartset=utf-8");
               resp.getWriter().print(JSON.toJSONString(R.ok()));
               break;
```



2、单个删除

##### 2.1 监听事件

```
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
```

##### 2.2 调用删除方法

```
//监听行工具事件
        table.on('tool(test)', function(obj){
            var data = obj.data;
            debugger
            //console.log(obj)
            if(obj.event === 'del'){
                layer.confirm('真的删除行么?', function(index){
                    //这里调用删除功能即可
                    deleteByIds(data.id,index);
                    // layer.close(index);
                });
            } else if(obj.event === 'edit'){
                layer.prompt({
                    formType: 2
                    ,value: data.email
                }, function(value, index){
                    obj.update({
                        email: value
                    });
                    layer.close(index);
                });
            }
        });
```

注意点：js作用域问题

### 1.1.11 房间类型-修改功能

1、根据id查询记录信息并渲染数据到form单中

2、提交修改工作

##### 1.事件监听

```
 else if(obj.event === 'edit'){
                var index = layer.open({
                    title: '修改类型',
                    type: 2,
                    shade: 0.2,
                    shadeClose: true,
                    area: ['60%', '60%'],
                    content: 'TypeUpdate.jsp?id='+data.id,
                });
                $(window).on("resize", function () {
                    layer.full(index);
                });
            }
```

##### 2 、设计修改页面

```
<%--
  Created by IntelliJ IDEA.
  User: zhouk
  Date: 2022/1/3
  Time: 21:30
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script type="text/javascript" src="./js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <input type="hidden" id="id" name="id">
        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span>类型名称
            </label>
            <div class="layui-input-inline">
                <input type="text" id="typeName"  name="typeName" required=""
                       autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">
                <span class="x-red">*</span>名称建议唯一
            </div>
        </div>
        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span>价格
            </label>
            <div class="layui-input-inline">
                <input type="text" id="price" name="price" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>备注信息
            </label>
            <div class="layui-input-inline">
                <input type="text" id="remark" name="remark" required=""
                       autocomplete="off" class="layui-input">
            </div>

        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="update" lay-submit="">
                修改房间类型
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer'], function(){
        $ = layui.jquery;
        var form = layui.form
            ,layer = layui.layer;

       <%
          String id=request.getParameter("id");
       %>
        //通过ajax请求像后端获取对象信息
        $.ajax({
            url:"../typeInfoServlet?flag=queryByID",
            type:"post",
            data:{id:<%=id%>},
            success:function(result){
                 $("#id").val(result.id);
                $("#price").val(result.price);
                $("#typeName").val(result.typeName);
                $("#remark").val(result.remark);
            }
        })



        //监听提交
        form.on('submit(update)', function(data){
            /*
               1、获取输入框的值信息
               2、通过ajax请求向后端发送请求
               3、根据响应反馈信息提示，并刷新主页
             */
            var data=data.field;
            $.ajax({
                url:"../typeInfoServlet?flag=updateSubmit",
                type:"post",
                data:data,
                success:function(result){
                    if(result.code==0){
                        layer.alert("修改成功", {icon: 6},function () {
                            // //关闭当前frame
                            // x_admin_close();
                            // // 可以对父窗口进行刷新
                            // x_admin_father_reload();
                            parent.window.location.reload();
                        });
                    }else{
                        layer.msg("不好意思，修改失败了...")
                    }
                }
            })

            return false;
        });


    });
</script>

</body>

</html>
```

##### 3、修改后端接口提供

```
 case "queryByID":
               String id=req.getParameter("id");
               try {
                   RoomType typeInfo= service.queryByID(Integer.parseInt(id));
                   resp.setContentType("application/json;chartset=utf-8");
                   resp.getWriter().print(JSON.toJSONString(typeInfo));
               } catch (SQLException throwables) {
                   throwables.printStackTrace();
               }
               break;
           case "updateSubmit":
               //调用添加方法
               RoomType type2= getValues(req);
               boolean bs2=service.updateInfo(type2);
               resp.setContentType("application/json;chartset=utf-8");
               String jsons2=JSON.toJSONString(R.fail("修改失败了..."));
               if(bs2){
                   jsons2=JSON.toJSONString(R.ok());
               }
               resp.getWriter().print(jsons2);
               break;
```

注意点：

​        使用添加和修改的时候，提取了公共的方法

注意点：如果出现分页乱码，使用提供的 laypage.js文件置换即可

## 2、房间信息管理

功能解析：

 1、房间信息查询(普通查询，以及高级查询 分页查询)

 2、房间信息的添加功能 (支持图片上传功能)

 3、房间信息删除以及批量删除功能

 4、房间信息的编辑功能

### 2.1 后端接口的实现

#### 2.1.1 添加工具类

![1641477438121](C:\Users\zhouk\AppData\Roaming\Typora\typora-user-images\1641477438121.png)

注意点：如果使用了该工具类，实体对象属性名称严格和数据库表中字段一致

#### 2.1.2 model层创建

```
package com.yanzhen.model;

import java.util.Date;

public class RoomInfo {
    private Integer id;
    private String  number;
    private Double area;
    private Integer    room_id;
    private Integer counts;
    private Integer    bed;
    private String img;
    private Integer     status;
    private Double price;
    private Double    discount;
    private String remark;
    private Date create_time;
    private String create_author;
    private Date       update_time;
    private String update_author;
    private String type_name;

    public String getType_name() {
        return type_name;
    }

    public void setType_name(String type_name) {
        this.type_name = type_name;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getNumber() {
        return number;
    }

    public void setNumber(String number) {
        this.number = number;
    }

    public Double getArea() {
        return area;
    }

    public void setArea(Double area) {
        this.area = area;
    }

    public Integer getRoom_id() {
        return room_id;
    }

    public void setRoom_id(Integer room_id) {
        this.room_id = room_id;
    }

    public Integer getCounts() {
        return counts;
    }

    public void setCounts(Integer counts) {
        this.counts = counts;
    }

    public Integer getBed() {
        return bed;
    }

    public void setBed(Integer bed) {
        this.bed = bed;
    }

    public String getImg() {
        return img;
    }

    public void setImg(String img) {
        this.img = img;
    }

    public Integer getStatus() {
        return status;
    }

    public void setStatus(Integer status) {
        this.status = status;
    }

    public Double getPrice() {
        return price;
    }

    public void setPrice(Double price) {
        this.price = price;
    }

    public Double getDiscount() {
        return discount;
    }

    public void setDiscount(Double discount) {
        this.discount = discount;
    }

    public String getRemark() {
        return remark;
    }

    public void setRemark(String remark) {
        this.remark = remark;
    }

    public Date getCreate_time() {
        return create_time;
    }

    public void setCreate_time(Date create_time) {
        this.create_time = create_time;
    }

    public String getCreate_author() {
        return create_author;
    }

    public void setCreate_author(String create_author) {
        this.create_author = create_author;
    }

    public Date getUpdate_time() {
        return update_time;
    }

    public void setUpdate_time(Date update_time) {
        this.update_time = update_time;
    }

    public String getUpdate_author() {
        return update_author;
    }

    public void setUpdate_author(String update_author) {
        this.update_author = update_author;
    }
}

```

#### 2.1.3 dao层接口和实现

```
package com.yanzhen.dao;

import com.yanzhen.model.RoomInfo;

import java.sql.SQLException;
import java.util.List;

public interface RoomInfoDao {
    /**
     * 查询房间列表
     * @param startPage 起始页
     * @param limit  每页显示的记录数据
     * @param content  高级查询的条件
     * @return
     */
    List<RoomInfo> queryList(int startPage, int limit, String content) throws SQLException;


    /**
     * 获取总的记录数据
     */
    int getCounts(String content) throws SQLException;

    /**
     * 增加类型
     */
    boolean saveInfo(RoomInfo info);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    RoomInfo queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(RoomInfo info);
}

```

实现

```
package com.yanzhen.dao.impl;

import com.yanzhen.dao.RoomInfoDao;
import com.yanzhen.model.RoomInfo;
import com.yanzhen.util.DbUtils;

import java.sql.SQLException;
import java.util.List;

public class RoomInfoDaoImpl implements RoomInfoDao {
    DbUtils utils=new DbUtils();
    @Override
    public List<RoomInfo> queryList(int startPage, int limit, String content) throws SQLException {
        String sql="select info.*,type_name from room_info info \n" +
                "left join room_type type on type.id=info.room_id";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append( " and number like '"+content+"'");
        }
        sb.append(" limit "+startPage+","+limit);
        List<RoomInfo> list=utils.list(RoomInfo.class,sb.toString(),null);
        return list;
    }

    @Override
    public int getCounts(String content) throws SQLException {
        String sql="select info.*,type_name from room_info info \n" +
                "left join room_type type on type.id=info.room_id";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append( " and number like '"+content+"'");
        }
        int num=utils.getCount(sb.toString());
        return num;
    }

    @Override
    public boolean saveInfo(RoomInfo info) {
        return false;
    }

    @Override
    public boolean deleteById(Integer id) {
        return false;
    }

    @Override
    public RoomInfo queryByID(Integer id) throws SQLException {
        return null;
    }

    @Override
    public boolean updateInfo(RoomInfo info) {
        return false;
    }
}

```

#### 2.1.4 service层接口和实现

```
public interface RoomInfoService {

    /**
     * 分页查询
     */
    PageBean getPage(String page, String limit, String content) throws SQLException;


}
```

实现

````
public class RoomInfoServiceImpl implements RoomInfoService {
    RoomInfoDao dao=new RoomInfoDaoImpl();
    @Override
    public PageBean getPage(String page, String limit, String content) throws SQLException {
        //引入分页对象
        PageBean<RoomInfo> pageBean=new PageBean<>();
        //当前页
        Integer page2=Integer.parseInt(page);
        //每页显示记录数
        Integer limit2=Integer.parseInt(limit);
        //起始记录数  类似
        int startPage=(page2-1)*pageBean.getPageCount();
        //总的记录数据
        int counts=dao.getCounts(content);
        //获取list  开始记录
        List<RoomInfo> list= dao.queryList(startPage,limit2,content);
        //设置对象
        pageBean.setPageData(list);
        //总的数据
        pageBean.setTotalCount(counts);
        //总的页数
        pageBean.setTotalPage(counts/pageBean.getPageCount()+1);
        return pageBean;
    }
}

````

#### 2.1.5 controller层实现

```
package com.yanzhen.controller;

import com.alibaba.fastjson.JSON;
import com.yanzhen.model.RoomInfo;
import com.yanzhen.model.RoomType;
import com.yanzhen.service.RoomInfoService;
import com.yanzhen.service.impl.RoomInfoServiceImpl;
import com.yanzhen.util.JsonObject;
import com.yanzhen.util.PageBean;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;

@WebServlet("/roomServlet")
public class RoomInfoServlet extends HttpServlet {
    RoomInfoService service=new RoomInfoServiceImpl();
    @Override
    protected void service(HttpServletRequest req,
                           HttpServletResponse resp) throws ServletException, IOException {
        //接收前端的传值  当前页 每页显示记录数
        String currPage=req.getParameter("page");
        String limit=req.getParameter("limit");
        String content=req.getParameter("content")==null?null:req.getParameter("content");
        //判断
        if(currPage==null || "".equals(currPage.trim())){
            currPage="1";
        }

        if(limit==null || "".equals(limit.trim())){
            limit="10";
        }

        //通过service层接口拿到分页对象
        PageBean<RoomInfo> pageBean=null;
        try {
            pageBean = service.getPage(currPage,limit,content);
        } catch (SQLException throwables) {
            throwables.printStackTrace();
        }

        //转到前端
        JsonObject object=new JsonObject();
        object.setCode(0);
        object.setMsg("");
        object.setCount(pageBean.getTotalCount());
        object.setData(pageBean.getPageData());

        resp.setContentType("application/json;chartset=utf-8");
        String jsons= JSON.toJSONString(object);
        resp.getWriter().print(jsons);

    }
}

```

### 2.2 前端页面设计

![1641477677348](C:\Users\zhouk\AppData\Roaming\Typora\typora-user-images\1641477677348.png)

```
<%@page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
<html>
<head>
    <meta charset="UTF-8">
  <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
<%--    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">--%>
<%--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />--%>
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .laytable-cell-checkbox, .laytable-cell-numbers, .laytable-cell-radio, .laytable-cell-space {
            padding: 5px;
            text-align: center;
        }
    </style>
</head>

<body class="">
<div class="x-nav">
      <span class="layui-breadcrumb">
        <a href="">首页</a>
        <a href="">演示</a>
        <a>
          <cite>导航元素</cite></a>
      </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
</div>
<div class="x-body">
    <div class="demoTable">
        类型名称：
        <div class="layui-inline">
            <input class="layui-input" name="typeName" id="typeName" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
    </div>
    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
        <xblock>
            <button class="layui-btn layui-btn-danger" lay-event="getCheckData">批量删除</button>
            <button class="layui-btn" onclick="x_admin_show('添加房间类型','./TypeAdd.jsp',600,400)"><i class="layui-icon"></i>添加</button>
        </xblock>
        </div>
    </script>
    <table class="layui-table" lay-data="{url:'<%=basePath%>roomServlet',page:true,toolbar: '#toolbarDemo',id:'test'}" lay-filter="test">
        <thead>
        <tr>
            <th lay-data="{type:'checkbox'}">ID</th>
            <th lay-data="{field:'id', width:120, sort: true}">ID</th>
            <th lay-data="{field:'number', width:200}">房间编号</th>
            <th lay-data="{field:'type_name',  width: 150}">房间类型</th>
            <th lay-data="{field:'price', width:100, sort: true}">价格</th>
            <th lay-data="{field:'area',  width: 150}">面积</th>
            <th lay-data="{field:'create_time',templet: '#dateTpl',width: 150}">创建时间</th>
            <th lay-data="{field:'create_author', width: 150}">创建人</th>
            <th lay-data="{fixed: 'right', width:220, align:'center', toolbar: '#barDemo'}">操作</th>
        </tr>
        </thead>
    </table>

</div>

<script type="text/html" id="dateTpl">
   {{ layui.util.toDateString(d.createTime,"yyyy-MM-dd")}}
</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script type="text/html" id="switchTpl">
    <!-- 这里的 checked 的状态只是演示 -->
    <input type="checkbox" name="sex" value="{{d.id}}" lay-skin="switch" lay-text="女|男" lay-filter="sexDemo" {{ d.id == 10003 ? 'checked' : '' }}>
</script>
<script>
    layui.use(['form', 'table'], function () {
        var form = layui.form,
            table = layui.table;

        var $ = layui.$, active = {
            reload: function(){
                var typeName = $('#typeName').val();
                debugger
                //执行重载
                table.reload('test', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                       content: typeName
                    }
                }, 'data');
            }
        };

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });



    });
</script>

</body>

</html>

```

注意点：路径问题

```
<%@page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
```

### 2.3 房间管理-高级查询

页面更改以及整理

```
<div class="demoTable">
        房间编号：
        <div class="layui-inline">
            <input class="layui-input" name="number" id="number" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
    </div>
    
 监听事件
  var $ = layui.$, active = {
            reload: function(){
                var number = $('#number').val();
                debugger
                //执行重载
                table.reload('test', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                       content: number
                    }
                }, 'data');
            }
        };
```

### 2.4 房间管理-后端接口实现

#### 2.4.1 dao层接口和实现

```
 /**
     * 增加
     */
    boolean saveInfo(RoomInfo info);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    RoomInfo queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(RoomInfo info);
```

实现：

```
 @Override
    public boolean saveInfo(RoomInfo info) {
        String date= DateUtil.dateChangeString(new Date());
        String sql="insert into room_info " +
                "(number,area,room_id,counts,bed,img,status,price,remark,create_time,create_author) values(" +
                " '"+info.getNumber()+"',"+info.getArea()+","+info.getRoom_id()+","+info.getCounts()+"," +
                ""+info.getBed()+",'"+info.getImg()+"',"+info.getStatus()+","+info.getPrice()+",'"+info.getRemark()+"'," +
                " '"+date+"','"+info.getCreate_author()+"')";
        int nums=JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(nums>0){
            return true;
        }
        return false;
    }

    @Override
    public boolean deleteById(Integer id) {
        String sql="delete from room_info where id="+id;
        int nums=JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(nums>0){
            return true;
        }
        return false;
    }

    @Override
    public RoomInfo queryByID(Integer id) throws SQLException {
        String sql="select * from room_info where id="+id;
        RoomInfo info=utils.query(RoomInfo.class,sql,null);
        return info;
    }

    @Override
    public boolean updateInfo(RoomInfo info) {
        String sql="update room_info set area="+info.getArea()+"," +
                " room_id="+info.getRoom_id()+"," +
                " img='"+info.getImg()+"',status="+info.getStatus()+"," +
                " remark='"+info.getRemark()+"' where id="+info.getId();
        int nums=JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(nums>0){
            return true;
        }
        return false;
    }
```

#### 2,4.2 service接口和实现

```
 /**
     * 增加
     */
    boolean saveInfo(RoomInfo info);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    RoomInfo queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(RoomInfo info);
```

实现

```
 @Override
    public boolean saveInfo(RoomInfo info) {
        return dao.saveInfo(info);
    }

    @Override
    public boolean deleteById(Integer id) {
        return dao.deleteById(id);
    }

    @Override
    public RoomInfo queryByID(Integer id) throws SQLException {
        return dao.queryByID(id);
    }
```



#### 2.4.3 controller层接口

```
package com.yanzhen.controller;

import com.alibaba.fastjson.JSON;
import com.yanzhen.model.RoomInfo;
import com.yanzhen.model.RoomType;
import com.yanzhen.service.RoomInfoService;
import com.yanzhen.service.impl.RoomInfoServiceImpl;
import com.yanzhen.util.JsonObject;
import com.yanzhen.util.PageBean;
import com.yanzhen.util.R;
import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileItemFactory;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.IOException;
import java.sql.SQLException;
import java.util.Arrays;
import java.util.Iterator;
import java.util.List;
import java.util.UUID;

@WebServlet("/roomServlet")
public class RoomInfoServlet extends HttpServlet {
    RoomInfoService service=new RoomInfoServiceImpl();
    @Override
    protected void service(HttpServletRequest req,
                           HttpServletResponse resp) throws ServletException, IOException {
       //接收前端传过来的功能标识
        String flag=req.getParameter("flag")==null?"":req.getParameter("flag");
        switch (flag){
            case "insert":
                RoomInfo info=getValues(req);
                service.saveInfo(info);
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;
            case "upload":
                try {
                    uploadFile(req,resp);
                } catch (Exception e) {
                    e.printStackTrace();
                }
                break;
            case "delete":
                String ids=req.getParameter("ids");
                //把接收到的字符串转成集合
                List<String> idList= Arrays.asList(ids.split(","));
                for(String id:idList){
                    service.deleteById(Integer.parseInt(id));
                }
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;
            case "queryId":
                String id=req.getParameter("id");
                RoomInfo info1= null;
                try {
                    info1 = service.queryByID(Integer.parseInt(id));
                } catch (SQLException throwables) {
                    throwables.printStackTrace();
                }
                req.setAttribute("info",info1);
                resp.setContentType("text/html;chartset=utf-8");
                req.getRequestDispatcher("admin/room/update.jsp").forward(req,resp);
                break;
            case "update":
                RoomInfo roomInfo=getValues(req);
                boolean bs=service.updateInfo(roomInfo);
                resp.setContentType("application/json;chartset=utf-8");
                String jsons2=JSON.toJSONString(R.fail("修改失败了..."));
                if(bs){
                    jsons2=JSON.toJSONString(R.ok());
                }
                resp.getWriter().print(jsons2);
                break;
            default:
                query(req,resp);
                break;
        }

    }

    /**
     * 上传图片接口
     */
    public void uploadFile(HttpServletRequest req,
                           HttpServletResponse resp) throws Exception {
        //文件上传处理器
        FileItemFactory factory=new DiskFileItemFactory();
        ServletFileUpload upload=new ServletFileUpload(factory);
        //解析请求信息
        List items=upload.parseRequest(req);
        Iterator it=items.iterator();
        String fileName="";
        if(it.hasNext()){
           FileItem item= (FileItem) it.next();
            fileName=item.getName();
           //获取文件的后缀名
           String suffName= fileName.substring(fileName.lastIndexOf("."));
           //随机生成文件名称
           fileName= UUID.randomUUID()+suffName;
           req.setAttribute("fileName",fileName);
           //真实上传到的文件地址  注意文件夹存在
           String basePath="D:\\images";
           File f=new File(basePath);
           if(!f.exists()){
               f.mkdirs();
           }
           File file=new File(basePath,fileName);
           item.write(file);
        }
        resp.setContentType("application/json;chartset=utf-8");
        String json=JSON.toJSONString(R.ok(fileName,null));
        resp.getWriter().print(json);
    }



        /**
         * 根据前端传值获取对应的值信息，并把值信息封装到RoomInfo 对象中
         * @param req
         * @return
         */
    public RoomInfo getValues(HttpServletRequest req){
        //根据id判断是修改还新增，如修改id不为空
        RoomInfo info=new RoomInfo();
        String id=req.getParameter("id")==null?null:req.getParameter("id");
        if(id!=null){
           info.setId(Integer.parseInt(id));
        }
        String number=req.getParameter("number");
        String area=req.getParameter("area");
        String roomId=req.getParameter("roomId");
        String counts=req.getParameter("counts");
        String img=req.getParameter("img");
        String status=req.getParameter("status");
        String price=req.getParameter("price");
        String remark=req.getParameter("remark");
        info.setArea(Double.parseDouble(area));
        info.setNumber(number);
        info.setRoom_id(Integer.parseInt(roomId));
        info.setCounts(Integer.parseInt(counts));
        info.setImg(img);
        info.setStatus(Integer.parseInt(status));
        info.setPrice(Double.parseDouble(price));
        info.setRemark(remark);
        return info;
    }
    /**
     * 查询
     */
    public void query(HttpServletRequest req,
                      HttpServletResponse resp) throws ServletException, IOException {

        //接收前端的传值  当前页 每页显示记录数
        String currPage=req.getParameter("page");
        String limit=req.getParameter("limit");
        String content=req.getParameter("content")==null?null:req.getParameter("content");
        //判断
        if(currPage==null || "".equals(currPage.trim())){
            currPage="1";
        }

        if(limit==null || "".equals(limit.trim())){
            limit="10";
        }

        //通过service层接口拿到分页对象
        PageBean<RoomInfo> pageBean=null;
        try {
            pageBean = service.getPage(currPage,limit,content);
        } catch (SQLException throwables) {
            throwables.printStackTrace();
        }

        //转到前端
        JsonObject object=new JsonObject();
        object.setCode(0);
        object.setMsg("");
        object.setCount(pageBean.getTotalCount());
        object.setData(pageBean.getPageData());

        resp.setContentType("application/json;chartset=utf-8");
        String jsons= JSON.toJSONString(object);
        resp.getWriter().print(jsons);
    }
}

```

注意点：上传图片加依赖包

### 2.5 新增页面设计

```
<%@page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
    String basePath2=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort();
%>
<html>
<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
    <%--    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">--%>
    <%--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />--%>
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <input type="hidden" id="img" name="img" >
        <div class="layui-form-item">
            <label for="number" class="layui-form-label">
                <span class="x-red">*</span>房间编号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="number" name="number" required=""
                       autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">
                <span class="x-red">*</span>名称建议唯一
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">房间类型</label>
            <div class="layui-input-inline">
                <select name="roomId" id="typeId" lay-verify="required" lay-search="">
                    <option value="">请选择</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label for="area" class="layui-form-label">
                <span class="x-red">*</span>面积
            </label>
            <div class="layui-input-inline">
                <input type="text" id="area" name="area" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <!--上传图片开始-->
        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span>房间图片
            </label>
            <div class="layui-input-inline">
                <div class="layui-upload-drag" id="test10">
                    <i class="layui-icon"></i>
                    <p>点击上传，或将文件拖拽到此处</p>
                    <div class="layui-hide" id="uploadDemoView">
                        <hr>
                        <img src="" alt="上传成功后渲染" style="max-width: 196px">
                    </div>
                </div>
            </div>
        </div>
        <!--上传图片结束-->
        <div class="layui-form-item">
            <label for="price" class="layui-form-label">
                <span class="x-red">*</span>价格
            </label>
            <div class="layui-input-inline">
                <input type="text" id="price" name="price" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="counts" class="layui-form-label">
                <span class="x-red">*</span>人数
            </label>
            <div class="layui-input-inline">
                <input type="text" id="counts" name="counts" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>


        <div class="layui-form-item">
            <label class="layui-form-label">状态</label>
            <div class="layui-input-block">
                <input type="checkbox" checked="" name="status" lay-skin="switch" lay-filter="switchTest" lay-text="ON|OFF">
            </div>
        </div>

        <div class="layui-form-item">
            <label for="L_pass" class="layui-form-label">
                <span class="x-red">*</span>备注信息
            </label>
            <div class="layui-input-inline">
                <input type="text" id="L_pass" name="remark" required=""
                       autocomplete="off" class="layui-input">
            </div>

        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="add" lay-submit="">
                添加房间
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['upload','form','layer'], function(){
        $ = layui.jquery;
        var upload = layui.upload;
        var form = layui.form
            ,layer = layui.layer;

        //通过ajax请求向后端获取类型名称数据并渲染到指定select位置
        $.get("<%=basePath%>typeInfoServlet?flag=queryTypeList",{},function (data) {
            var list=data;
            var select=document.getElementById("typeId");
            if(list!=null ){
                for(var c in list){
                    var option=document.createElement("option");
                    option.setAttribute("value",list[c].id);
                    option.innerText=list[c].typeName;
                    select.appendChild(option);
                }
            }
            form.render("select");
        },"json")


        //拖拽上传
        upload.render({
            elem: '#test10'
            ,url: '<%=basePath%>roomServlet?flag=upload' //此处用的是第三方的 http 请求演示，实际使用时改成您自己的上传接口即可。
            ,done: function(res){
                debugger
                layer.msg('上传成功');
                layui.$('#uploadDemoView').removeClass('layui-hide').find('img').attr('src', "<%=basePath2%>/images/"+res.msg);
                //给隐藏域赋值
                $("#img").val("images/"+res.msg);
                console.log(res)
            }
        });


        //监听提交
        form.on('submit(add)', function(data){
            /*
               1、获取输入框的值信息
               2、通过ajax请求向后端发送请求
               3、根据响应反馈信息提示，并刷新主页
             */
            var data=data.field;

            if(data.status=='ON'){
                data.status=1;
            }else{
                data.status=0;
            }
           debugger
            $.ajax({
                url:"<%=basePath%>roomServlet?flag=insert",
                type:"post",
                data:data,
                success:function(result){
                    if(result.code==0){
                        layer.alert("增加成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("不好意思，添加失败了...")
                    }
                }
            })
            // console.log(data);
            // //发异步，把数据提交给php

            return false;
        });


    });
</script>

</body>

</html>
```

### 2.6 修改页面设计

```
<%@page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
    String basePath2=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort();
%>
<html>
<head>
    <meta charset="UTF-8">
    <title>页面修改</title>
    <meta name="renderer" content="webkit">
    <%--    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">--%>
    <%--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />--%>
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <input type="hidden" id="img" name="img" >
        <input type="hidden" name="id" value="${info.id}">
        <input type="hidden" name="typeIds" id="typeIds" value="${info.room_id}">
        <div class="layui-form-item">
            <label for="number" class="layui-form-label">
                <span class="x-red">*</span>房间编号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="number" name="number" required=""
                       autocomplete="off" class="layui-input" value="${info.number}">
            </div>
            <div class="layui-form-mid layui-word-aux">
                <span class="x-red">*</span>名称建议唯一
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">房间类型</label>
            <div class="layui-input-inline">
                <select name="roomId" id="typeId" lay-verify="required" lay-search="">
                    <option value="">请选择</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label for="area" class="layui-form-label">
                <span class="x-red">*</span>面积
            </label>
            <div class="layui-input-inline">
                <input type="text" id="area" name="area" required=""
                       autocomplete="off" class="layui-input" value="${info.area}">
            </div>
        </div>
        <!--上传图片开始-->
        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span>房间图片
            </label>
            <div class="layui-input-inline">
                <div class="layui-upload-drag" id="test10">
                    <i class="layui-icon"></i>
                    <p>点击上传，或将文件拖拽到此处</p>
                    <div class="layui-hide" id="uploadDemoView">
                        <hr>
                        <img src="<%=basePath2%>/${info.img}" alt="上传成功后渲染" style="max-width: 196px">
                    </div>
                </div>
            </div>
        </div>
        <!--上传图片结束-->
        <div class="layui-form-item">
            <label for="price" class="layui-form-label">
                <span class="x-red">*</span>价格
            </label>
            <div class="layui-input-inline">
                <input type="text" id="price" name="price" required=""
                       autocomplete="off" class="layui-input" value="${info.price}">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="counts" class="layui-form-label">
                <span class="x-red">*</span>人数
            </label>
            <div class="layui-input-inline">
                <input type="text" id="counts" name="counts" required=""
                       autocomplete="off" class="layui-input" value="${info.counts}">
            </div>
        </div>


        <div class="layui-form-item">
            <label class="layui-form-label">状态</label>
            <div class="layui-input-block">
                <input type="checkbox" <c:if test="${info.status==1}">checked </c:if> name="status" lay-skin="switch" lay-filter="switchTest" lay-text="正常|禁用">
            </div>
        </div>

        <div class="layui-form-item">
            <label for="L_pass" class="layui-form-label">
                <span class="x-red">*</span>备注信息
            </label>
            <div class="layui-input-inline">
                <input type="text" id="L_pass" name="remark" required=""
                       autocomplete="off" class="layui-input" value="${info.remark}">
            </div>

        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="update" lay-submit="">
                编辑房间
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['upload','form','layer'], function(){
        $ = layui.jquery;
        var upload = layui.upload;
        var form = layui.form
            ,layer = layui.layer;

        //通过ajax请求向后端获取类型名称数据并渲染到指定select位置
        $.get("<%=basePath%>typeInfoServlet?flag=queryTypeList",{},function (data) {
            var list=data;
            var select=document.getElementById("typeId");
            var value=document.getElementById("typeIds").value;
            if(list!=null ){
                for(var c in list){
                    var option=document.createElement("option");
                    option.setAttribute("value",list[c].id);
                    option.innerText=list[c].typeName;
                    select.appendChild(option);
                    if(list[c].id==value){
                        option.setAttribute("selected","selected");
                    }
                }
            }
            form.render("select");
        },"json")


        //拖拽上传
        upload.render({
            elem: '#test10'
            ,url: '<%=basePath%>roomServlet?flag=upload' //此处用的是第三方的 http 请求演示，实际使用时改成您自己的上传接口即可。
            ,done: function(res){
                debugger
                layer.msg('上传成功');
                layui.$('#uploadDemoView').removeClass('layui-hide').find('img').attr('src', "<%=basePath2%>/images/"+res.msg);
                //给隐藏域赋值
                $("#img").val("images/"+res.msg);
                console.log(res)
            }
        });

        //显示图片信息
        layui.$('#uploadDemoView').removeClass('layui-hide')
        // layui.$("#uploadDemoView").removeClass('layui-hide');


        //监听提交
        form.on('submit(update)', function(data){
            /*
               1、获取输入框的值信息
               2、通过ajax请求向后端发送请求
               3、根据响应反馈信息提示，并刷新主页
             */
            var data=data.field;

            if(data.status=='ON'){
                data.status=1;
            }else{
                data.status=0;
            }
           debugger
            $.ajax({
                url:"<%=basePath%>roomServlet?flag=update",
                type:"post",
                data:data,
                success:function(result){
                    if(result.code==0){
                        layer.alert("修改成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("不好意思，修改失败了...")
                    }
                }
            })

            return false;
        });


    });
</script>

</body>

</html>
```

注意点：

```
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt" %>
```

## 3、主页页面设计导航更改

```
<%--
  Created by IntelliJ IDEA.
  User: zhouk
  Date: 2022/1/2
  Time: 11:01
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html  class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>管理系统</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript"src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
    <script src="./lib/layui/layui.js" charset="utf-8"></script>

    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script type="text/javascript" src="./js/cookie.js"></script>
    <script>
        // 是否开启刷新记忆tab功能
        // var is_remember = false;
    </script>
</head>
<body>
<!-- 顶部开始 -->
<div class="container">
    <div class="logo"><a href="./index.html">酒店后端管理系统</a></div>
    <div class="left_open">
        <i title="展开左侧栏" class="iconfont">&#xe699;</i>
    </div>
    <ul class="layui-nav left fast-add" lay-filter="">
    </ul>
    <ul class="layui-nav right" lay-filter="">
        <li class="layui-nav-item">
            <a href="javascript:;">admin</a>
            <dl class="layui-nav-child"> <!-- 二级菜单 -->
                <dd><a onclick="x_admin_show('个人信息','https://www.murongmengjie.cn')">个人信息</a></dd>
                <dd><a onclick="x_admin_show('切换帐号','http://www.baidu.com')">切换帐号</a></dd>
                <dd><a href="./login.html">退出</a></dd>
            </dl>
        </li>
        <li class="layui-nav-item to-index"><a href="./index.html">前台首页</a></li>
    </ul>

</div>
<!-- 顶部结束 -->

<!-- 中部开始 -->
<!-- 左侧菜单开始 -->
<!--第一个-->
<div class="left-nav">
    <div id="side-nav">
        <ul id="nav">
            <li>
                <a href="javascript:;">
                    <i class="iconfont">&#xe6b8;</i>
                    <cite>基础设置</cite>
                    <i class="iconfont nav_right">&#xe697;</i>
                </a>
                <ul class="sub-menu">
                    <li>
                        <a _href="TypeIndex.jsp">
                            <i class="iconfont">&#xe6a7;</i>
                            <cite>类型管理</cite>
                        </a>
                    </li >
               <li>
                   <a _href="room/index.jsp">
                       <i class="iconfont">&#xe6a7;</i>
                       <cite>房间管理</cite>
                   </a>
               </li >
                    <li>
                        <a _href="user/index.jsp">
                            <i class="iconfont">&#xe6a7;</i>
                            <cite>用户管理</cite>
                        </a>
                    </li >

                </ul>
            </li>
            <li>
                <a href="javascript:;">
                    <i class="iconfont">&#xe723;</i>
                    <cite>业务管理</cite>
                    <i class="iconfont nav_right">&#xe697;</i>
                </a>
                <ul class="sub-menu">
                    <li>
                        <a _href="zzzl.html">
                            <i class="iconfont">&#xe6a7;</i>
                            <cite>预定管理</cite>
                        </a>
                    </li >
                    <li>
                        <a _href="zzzl.html">
                            <i class="iconfont">&#xe6a7;</i>
                            <cite>退房管理</cite>
                        </a>
                    </li >
                    <li>
                        <a _href="zzzl.html">
                            <i class="iconfont">&#xe6a7;</i>
                            <cite>评论管理</cite>
                        </a>
                    </li >
                </ul>
            </li>

            <li>
                <a href="javascript:;">
                    <i class="iconfont">&#xe6ce;</i>
                    <cite>系统统计</cite>
                    <i class="iconfont nav_right">&#xe697;</i>
                </a>
                <ul class="sub-menu">
                    <li>
                        <a _href="echarts1.html">
                            <i class="iconfont">&#xe6a7;</i>
                            <cite>拆线图</cite>
                        </a>
                    </li >

                </ul>
            </li>

        </ul>
    </div>
</div>
<!-- <div class="x-slide_left"></div> -->
<!-- 左侧菜单结束 -->

<!-- 右侧主体开始 -->
<div class="page-content">
    <div class="layui-tab tab" lay-filter="xbs_tab" lay-allowclose="false">
        <ul class="layui-tab-title">
            <li class="home"><i class="layui-icon">&#xe68e;</i>我的桌面</li>
        </ul>
        <div class="layui-unselect layui-form-select layui-form-selected" id="tab_right">
            <dl>
                <dd data-type="this">关闭当前</dd>
                <dd data-type="other">关闭其它</dd>
                <dd data-type="all">关闭全部</dd>
            </dl>
        </div>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <iframe src='TypeIndex.jsp' frameborder="0" scrolling="yes" class="x-iframe"></iframe>
            </div>
        </div>
        <div id="tab_show"></div>
    </div>
</div>
<div class="page-content-bg"></div>
<!-- 右侧主体结束 -->

<!-- 中部结束 -->

<!-- 底部开始 -->
<div class="footer">
    <div class="copyright">Copyright ©2017 x-admin v2.3 All Rights Reserved</div>
</div>
<!-- 底部结束 -->
<!-- <script>
 //百度统计可去掉
 var _hmt = _hmt || [];
 (function() {
   var hm = document.createElement("script");
   hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
   var s = document.getElementsByTagName("script")[0];
   s.parentNode.insertBefore(hm, s);
 })();
 </script>-->
</body>
</html>

```

## 4 用户管理

### 4.1 功能列表

1、用户信息查询

2、用户添加

3、用户删除以及批量删除

4、用户的修改

5、修改密码

![1641701092158](C:\Users\zhouk\AppData\Roaming\Typora\typora-user-images\1641701092158.png)

### 4.2 后端接口提供

#### 4.2.1 model层类对象

```
package com.yanzhen.model;

import java.util.Date;

public class UserInfo {
    private Integer id;
    private String     nickname;
    private String   username;
    private String     identity;
    private String   tel;
    private String    email;
    private Date create_time;
    private String  sex;
    private Integer   type;
    private String  create_author;
    private String   password;
    private Date       update_time;
    private String update_author;
    private String photo;

    public String getPhoto() {
        return photo;
    }

    public void setPhoto(String photo) {
        this.photo = photo;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getNickname() {
        return nickname;
    }

    public void setNickname(String nickname) {
        this.nickname = nickname;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getIdentity() {
        return identity;
    }

    public void setIdentity(String identity) {
        this.identity = identity;
    }

    public String getTel() {
        return tel;
    }

    public void setTel(String tel) {
        this.tel = tel;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public Date getCreate_time() {
        return create_time;
    }

    public void setCreate_time(Date create_time) {
        this.create_time = create_time;
    }

    public String getSex() {
        return sex;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public Integer getType() {
        return type;
    }

    public void setType(Integer type) {
        this.type = type;
    }

    public String getCreate_author() {
        return create_author;
    }

    public void setCreate_author(String create_author) {
        this.create_author = create_author;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Date getUpdate_time() {
        return update_time;
    }

    public void setUpdate_time(Date update_time) {
        this.update_time = update_time;
    }

    public String getUpdate_author() {
        return update_author;
    }

    public void setUpdate_author(String update_author) {
        this.update_author = update_author;
    }
}

```

#### 4.2.2 dao层接口和实现

```
package com.yanzhen.dao;

import com.yanzhen.model.RoomType;
import com.yanzhen.model.UserInfo;

import java.sql.SQLException;
import java.util.List;

public interface UserInfoDao {
    List<UserInfo> queryList(int startPage, int limit, String content) throws SQLException;

    /**
     * 获取总的记录数据
     */
    int getCounts(String content) throws SQLException;

    /**
     * 增加类型
     */
    boolean saveInfo(UserInfo type);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    UserInfo queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(UserInfo type);

    /**
     * 根据用户修改密码
     * @param userID
     * @return
     */
    boolean updatePasswordByUserId(String password,Integer userID);
}

```

实现

```
package com.yanzhen.dao.impl;

import com.yanzhen.dao.UserInfoDao;
import com.yanzhen.model.RoomInfo;
import com.yanzhen.model.UserInfo;
import com.yanzhen.util.DateUtil;
import com.yanzhen.util.DbUtils;
import com.yanzhen.util.JdbcUtil;

import java.sql.SQLException;
import java.util.Date;
import java.util.List;

public class UserInfoDaoImpl implements UserInfoDao {
    DbUtils utils=new DbUtils();
    @Override
    public List<UserInfo> queryList(int startPage, int limit, String username) throws SQLException {
        String sql="select * from admin where 1=1 ";
        StringBuffer sb=new StringBuffer(sql);
        if(username!=null){
            username="%"+username+"%";
            sb.append( " and username like '"+username+"'");
        }
        sb.append(" limit "+startPage+","+limit);
        List<UserInfo> list=utils.list(UserInfo.class,sb.toString(),null);
        return list;
    }

    @Override
    public int getCounts(String username) throws SQLException {
        String sql="select * from admin where 1=1 ";
        StringBuffer sb=new StringBuffer(sql);
        if(username!=null){
            username="%"+username+"%";
            sb.append( " and username like '"+username+"'");
        }
        int num=utils.getCount(sql);
        return num;
    }

    @Override
    public boolean saveInfo(UserInfo info) {
        String date= DateUtil.dateChangeString(new Date());
        String sql="insert into admin " +
                "(nickname,username,identity,tel,email,create_time,sex,type,password,create_author) values(" +
                " '"+info.getNickname()+"','"+info.getUsername()+"','"+info.getIdentity()+"'," +
                " '"+info.getTel()+"'," +
                " '"+info.getEmail()+"','"+date+"','"+info.getSex()+"',"+info.getType()+",'"+info.getPassword()+"'," +
                " '"+info.getCreate_author()+"')";
        int nums= JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(nums>0){
            return true;
        }
        return false;
    }

    @Override
    public boolean deleteById(Integer id) {
        String sql="delete from admin where id="+id;
        int nums=JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(nums>0){
            return true;
        }
        return false;
    }

    @Override
    public UserInfo queryByID(Integer id) throws SQLException {
        String sql="select * from admin where id="+id;
        UserInfo info=utils.query(UserInfo.class,sql,null);
        return info;
    }

    @Override
    public boolean updateInfo(UserInfo type) {
        String sql="update admin set nickname='"+type.getNickname()+"'," +
                " username='"+type.getUsername()+"'," +
                " tel='"+type.getTel()+"',"+
                " email='"+type.getEmail()+"' where id="+type.getId();
        int nums=JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(nums>0){
            return true;
        }
        return false;
    }

    @Override
    public boolean updatePasswordByUserId(String password,Integer userID) {
        String sql="update admin set password='"+password+"' where id="+userID;
        int nums=JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(nums>0){
            return true;
        }
        return false;
    }
}

```

#### 4.2.3 service层

```
package com.yanzhen.service;

import com.yanzhen.model.UserInfo;
import com.yanzhen.util.PageBean;

import java.sql.SQLException;

public interface UserInfoService {

    /**
     * 分页查询
     */
    PageBean getPage(String page, String limit, String username) throws SQLException;


    /**
     * 增加类型
     */
    boolean saveInfo(UserInfo type);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    UserInfo queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(UserInfo type);

    /**
     * 根据用户修改密码
     * @param userID
     * @return
     */
    boolean updatePasswordByUserId(String password,Integer userID);
}

```

实现

```
package com.yanzhen.service.impl;

import com.yanzhen.dao.UserInfoDao;
import com.yanzhen.dao.impl.UserInfoDaoImpl;
import com.yanzhen.model.RoomInfo;
import com.yanzhen.model.UserInfo;
import com.yanzhen.service.UserInfoService;
import com.yanzhen.util.PageBean;

import java.sql.SQLException;
import java.util.List;

public class UserInfoServiceImpl implements UserInfoService {
    UserInfoDao dao=new UserInfoDaoImpl();
    @Override
    public PageBean getPage(String page, String limit, String username) throws SQLException {
        //引入分页对象
        PageBean<UserInfo> pageBean=new PageBean<>();
        //当前页
        Integer page2=Integer.parseInt(page);
        //每页显示记录数
        Integer limit2=Integer.parseInt(limit);
        //起始记录数  类似
        int startPage=(page2-1)*pageBean.getPageCount();
        //总的记录数据
        int counts=dao.getCounts(username);
        //获取list  开始记录
        List<UserInfo> list= dao.queryList(startPage,limit2,username);
        //设置对象
        pageBean.setPageData(list);
        //总的数据
        pageBean.setTotalCount(counts);
        //总的页数
        pageBean.setTotalPage(counts/pageBean.getPageCount()+1);
        return pageBean;
    }



    @Override
    public boolean saveInfo(UserInfo type) {
        return dao.saveInfo(type);
    }

    @Override
    public boolean deleteById(Integer id) {
        return dao.deleteById(id);
    }

    @Override
    public UserInfo queryByID(Integer id) throws SQLException {
        return dao.queryByID(id);
    }

    @Override
    public boolean updateInfo(UserInfo type) {
        return dao.updateInfo(type);
    }

    @Override
    public boolean updatePasswordByUserId(String password, Integer userID) {
        return dao.updatePasswordByUserId(password,userID);
    }
}

```

#### 4.2.4 servlet层

```
package com.yanzhen.controller;

import com.alibaba.fastjson.JSON;
import com.yanzhen.dao.UserInfoDao;
import com.yanzhen.model.RoomInfo;
import com.yanzhen.model.UserInfo;
import com.yanzhen.service.RoomInfoService;
import com.yanzhen.service.UserInfoService;
import com.yanzhen.service.impl.RoomInfoServiceImpl;
import com.yanzhen.service.impl.UserInfoServiceImpl;
import com.yanzhen.util.JsonObject;
import com.yanzhen.util.PageBean;
import com.yanzhen.util.R;
import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileItemFactory;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.IOException;
import java.sql.SQLException;
import java.util.Arrays;
import java.util.Iterator;
import java.util.List;
import java.util.UUID;

@WebServlet("/userServlet")
public class UserServlet extends HttpServlet {
    UserInfoService service=new UserInfoServiceImpl();
    @Override
    protected void service(HttpServletRequest req,
                           HttpServletResponse resp) throws ServletException, IOException {
        //接收前端传过来的功能标识
        String flag=req.getParameter("flag")==null?"":req.getParameter("flag");
        switch (flag){
            case "insert":
                UserInfo info=getValues(req);
                service.saveInfo(info);
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;
            case "updatePassword":
                String id2=req.getParameter("id");
                String password=req.getParameter("password");
                service.updatePasswordByUserId(password,Integer.parseInt(id2));
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;
            case "delete":
                String ids=req.getParameter("ids");
                //把接收到的字符串转成集合
                List<String> idList= Arrays.asList(ids.split(","));
                for(String id:idList){
                    service.deleteById(Integer.parseInt(ids));
                }
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;
            case "queryId":
                String id=req.getParameter("id");
                UserInfo info1= null;
                try {
                    info1 = service.queryByID(Integer.parseInt(id));
                } catch (SQLException throwables) {
                    throwables.printStackTrace();
                }
                req.setAttribute("info",info1);
                resp.setContentType("text/html;chartset=utf-8");
                req.getRequestDispatcher("admin/user/update.jsp").forward(req,resp);
                break;
            case "update":
                UserInfo roomInfo=getValues(req);
                boolean bs=service.updateInfo(roomInfo);
                resp.setContentType("application/json;chartset=utf-8");
                String jsons2=JSON.toJSONString(R.fail("修改失败了..."));
                if(bs){
                    jsons2=JSON.toJSONString(R.ok());
                }
                resp.getWriter().print(jsons2);
                break;
            default:
                query(req,resp);
                break;
        }

    }




    /**
     * 根据前端传值获取对应的值信息，并把值信息封装到RoomInfo 对象中
     * @param req
     * @return
     */
    public UserInfo getValues(HttpServletRequest req){
        //根据id判断是修改还新增，如修改id不为空
        UserInfo info=new UserInfo();
        String id=req.getParameter("id")==null?null:req.getParameter("id");
        if(id!=null){
            info.setId(Integer.parseInt(id));
        }
        String nickname=req.getParameter("nickname");
        String username=req.getParameter("username");
        String identity=req.getParameter("identity");
        String tel=req.getParameter("tel");
        String email=req.getParameter("email");
        String sex=req.getParameter("sex");
        String type=req.getParameter("type");
        String password=req.getParameter("password");
        info.setNickname(nickname);
        info.setUsername(username);
        info.setTel(tel);
        info.setIdentity(identity);
        info.setEmail(email);
        info.setSex(sex);
//        info.setType(Integer.parseInt(type));
        info.setType(1);
        info.setPassword(password);
        return info;
    }
    /**
     * 查询
     */
    public void query(HttpServletRequest req,
                      HttpServletResponse resp) throws ServletException, IOException {

        //接收前端的传值  当前页 每页显示记录数
        String currPage=req.getParameter("page");
        String limit=req.getParameter("limit");
        String content=req.getParameter("content")==null?null:req.getParameter("content");
        //判断
        if(currPage==null || "".equals(currPage.trim())){
            currPage="1";
        }

        if(limit==null || "".equals(limit.trim())){
            limit="10";
        }

        //通过service层接口拿到分页对象
        PageBean<UserInfo> pageBean=null;
        try {
            pageBean = service.getPage(currPage,limit,content);
        } catch (SQLException throwables) {
            throwables.printStackTrace();
        }

        //转到前端
        JsonObject object=new JsonObject();
        object.setCode(0);
        object.setMsg("");
        object.setCount(pageBean.getTotalCount());
        object.setData(pageBean.getPageData());

        resp.setContentType("application/json;chartset=utf-8");
        String jsons= JSON.toJSONString(object);
        resp.getWriter().print(jsons);
    }

}

```

### 4.3 前端页面设计

1 主页面

2、添加页面

3、修改页面

4、修改密码页面

#### 4.3.1 主页设计

```
<%@page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
<html>
<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
<%--    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">--%>
<%--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />--%>
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .laytable-cell-checkbox, .laytable-cell-numbers, .laytable-cell-radio, .laytable-cell-space {
            padding: 5px;
            text-align: center;
        }
    </style>
</head>

<body class="">
<div class="x-nav">
      <span class="layui-breadcrumb">
        <a href="">首页</a>
        <a href="">演示</a>
        <a>
          <cite>导航元素</cite></a>
      </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
</div>
<div class="x-body">
    <div class="demoTable">
        用户姓名：
        <div class="layui-inline">
            <input class="layui-input" name="username" id="username" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
    </div>
    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
        <xblock>
            <button class="layui-btn layui-btn-danger" lay-event="getCheckData">批量删除</button>
            <button class="layui-btn" onclick="x_admin_show('添加用户信息','<%=basePath%>/admin/user/add.jsp',600,600)"><i class="layui-icon"></i>添加</button>
        </xblock>
        </div>
    </script>
    <table class="layui-table" lay-data="{url:'<%=basePath%>userServlet',page:true,toolbar: '#toolbarDemo',id:'test'}" lay-filter="test">
        <thead>
        <tr>
            <th lay-data="{type:'checkbox'}">ID</th>
            <th lay-data="{field:'username', width:100}">用户名</th>
            <th lay-data="{field:'identity',  width: 150}">身份证</th>
            <th lay-data="{field:'sex',  width: 80}">性别</th>
            <th lay-data="{field:'nickname', width:100}">昵称</th>
            <th lay-data="{field:'tel',  width: 150}">电话</th>
            <th lay-data="{field:'email',  width: 150}">邮箱</th>
            <th lay-data="{field:'create_time',templet: '#dateTpl',width: 150}">创建时间</th>
            <th lay-data="{field:'create_author', width: 150}">创建人</th>
            <th lay-data="{fixed: 'right', width:220, align:'center', toolbar: '#barDemo'}">操作</th>
        </tr>
        </thead>
    </table>

</div>

<script type="text/html" id="dateTpl">
   {{ layui.util.toDateString(d.createTime,"yyyy-MM-dd")}}
</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="update">修改密码</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script type="text/html" id="switchTpl">
    <!-- 这里的 checked 的状态只是演示 -->
    <input type="checkbox" name="sex" value="{{d.id}}" lay-skin="switch" lay-text="女|男" lay-filter="sexDemo" {{ d.id == 10003 ? 'checked' : '' }}>
</script>
<script>
    layui.use(['form', 'table'], function () {
        var form = layui.form,
            table = layui.table;

        var $ = layui.$, active = {
            reload: function(){
                var username = $('#username').val();
                debugger
                //执行重载
                table.reload('test', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                        content: username
                    }
                }, 'data');
            }
        };

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

        /**
         * 根据数据获取选择记录的id集合
         */
        function getCheakIds(data){
            var arr=new Array();
            for(var i=0;i<data.length;i++){
                arr.push(data[i].id);
            }
            return arr.join(",");
        }

        /**
         * 根据id删除记录信息
         */
        function deleteByIds(ids,index){
            $.ajax({
                url:"<%=basePath%>userServlet?flag=delete",
                type:"post",
                data: {ids:ids},
                success:function(result){
                    if(result.code==0){
                        layer.alert("删除成功", {icon: 6},function () {
                            parent.window.location.reload();

                        });
                    }else{
                        layer.msg("不好意思，删除失败了...")
                    }
                }
            })
        }

        //监听行工具事件
        table.on('tool(test)', function(obj){
            var data = obj.data;
            debugger
            //console.log(obj)
            if(obj.event === 'del'){
                layer.confirm('真的删除行么?', function(index){
                    //这里调用删除功能即可
                    deleteByIds(data.id,index);
                    // layer.close(index);
                });
            } else if(obj.event === 'edit'){
                var index = layer.open({
                    title: '修改用户',
                    type: 2,
                    shade: 0.2,
                    shadeClose: true,
                    area: ['60%', '80%'],
                    content: '<%=basePath%>userServlet?flag=queryId&id='+data.id,
                });
                $(window).on("resize", function () {
                    layer.full(index);
                });
            }
            else if(obj.event === 'update'){
                    var index = layer.open({
                        title: '修改密码',
                        type: 2,
                        shade: 0.2,
                        shadeClose: true,
                        area: ['45%', '45%'],
                        content: '<%=basePath%>admin/user/updatePassword.jsp?id='+data.id,
                    });
                    $(window).on("resize", function () {
                        layer.full(index);
                    });
                }

        });
        //头部监听事件
        //头工具栏事件
        table.on('toolbar(test)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            if(obj.event=='getCheckData'){
                var data = checkStatus.data;
                /**
                 * 如果没有选择提示选择，如果选择获取选中id集合
                 */
                debugger
                if(data.length==0){
                    layer.msg("请选择您要删除的记录信息...")
                }else{
                    //获取id集合，进行删除工作
                    var ids=getCheakIds(data);
                    layer.confirm('您确定要删除记录吗？',function(index){
                       //执行删除工作
                        deleteByIds(ids,index);
                    })
                }

                // layer.alert(JSON.stringify(data));
            }

        });

    });
</script>

</body>

</html>

```

#### 4.3.2 新增页面设计

```
<%@page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
    String basePath2=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort();
%>
<html>
<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
    <%--    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">--%>
    <%--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />--%>
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <div class="layui-form-item">
            <label for="identity" class="layui-form-label">
                <span class="x-red">*</span>身份证号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="identity" name="identity" required=""
                       autocomplete="off" class="layui-input">
            </div>

        </div>

        <div class="layui-form-item">
            <label for="username" class="layui-form-label">
                <span class="x-red">*</span>用户名称
            </label>
            <div class="layui-input-inline">
                <input type="text" id="username" name="username" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="nickname" class="layui-form-label">
                <span class="x-red">*</span>用户昵称
            </label>
            <div class="layui-input-inline">
                <input type="text" id="nickname" name="nickname" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">性别</label>
            <div class="layui-input-block">
                <input type="checkbox" checked="" name="sex" lay-skin="switch" lay-filter="switchTest" lay-text="男|女">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="password" class="layui-form-label">
                <span class="x-red">*</span>用户密码
            </label>
            <div class="layui-input-inline">
                <input type="password" id="password" name="password" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label for="tel" class="layui-form-label">
                <span class="x-red">*</span>联系方式
            </label>
            <div class="layui-input-inline">
                <input type="text" id="tel" name="tel" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="email" class="layui-form-label">
                <span class="x-red">*</span>邮箱
            </label>
            <div class="layui-input-inline">
                <input type="text" id="email" name="email" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>


        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="add" lay-submit="">
                添加用户
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer'], function(){
        $ = layui.jquery;
        var form = layui.form
            ,layer = layui.layer;

        //监听提交
        form.on('submit(add)', function(data){
            /*
               1、获取输入框的值信息
               2、通过ajax请求向后端发送请求
               3、根据响应反馈信息提示，并刷新主页
             */
            var data=data.field;
            debugger
            //
            if(data.sex=='ON'){
                data.sex="女";
            }else{
                data.sex="男";
            }
           debugger
            $.ajax({
                url:"<%=basePath%>userServlet?flag=insert",
                type:"post",
                data:data,
                success:function(result){
                    if(result.code==0){
                        layer.alert("增加成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("不好意思，添加失败了...")
                    }
                }
            })
            return false;
        });


    });
</script>

</body>

</html>
```

#### 4.3.3 修改页面

```
<%@page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
  %>
<html>
<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
    <%--    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">--%>
    <%--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />--%>
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <input type="hidden" name="id" value="${info.id}">
        <div class="layui-form-item">
            <label for="identity" class="layui-form-label">
                <span class="x-red">*</span>身份证号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="identity" name="identity" required=""
                       autocomplete="off" class="layui-input"  value="${info.identity}">
            </div>

        </div>

        <div class="layui-form-item">
            <label for="username" class="layui-form-label">
                <span class="x-red">*</span>用户名称
            </label>
            <div class="layui-input-inline">
                <input type="text" id="username" name="username" required=""
                       autocomplete="off" class="layui-input" value="${info.username}">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="nickname" class="layui-form-label">
                <span class="x-red">*</span>用户昵称
            </label>
            <div class="layui-input-inline">
                <input type="text" id="nickname" name="nickname" required=""
                       autocomplete="off" class="layui-input" value="${info.nickname}">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">性别</label>
            <div class="layui-input-block">
                <input type="checkbox" <c:if test="${info.sex=='男'}">checked </c:if>   name="sex" lay-skin="switch" lay-filter="switchTest" lay-text="男|女">
            </div>
        </div>


        <div class="layui-form-item">
            <label for="tel" class="layui-form-label">
                <span class="x-red">*</span>联系方式
            </label>
            <div class="layui-input-inline">
                <input type="text" id="tel" name="tel" required=""
                       autocomplete="off" class="layui-input" value="${info.tel}">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="email" class="layui-form-label">
                <span class="x-red">*</span>邮箱
            </label>
            <div class="layui-input-inline">
                <input type="text" id="email" name="email" required=""
                       autocomplete="off" class="layui-input" value="${info.email}">
            </div>
        </div>


        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="add" lay-submit="">
                修改用户
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer'], function(){
        $ = layui.jquery;
        var form = layui.form
            ,layer = layui.layer;

        //监听提交
        form.on('submit(add)', function(data){
            /*
               1、获取输入框的值信息
               2、通过ajax请求向后端发送请求
               3、根据响应反馈信息提示，并刷新主页
             */
            var data=data.field;
            debugger
            //
            if(data.sex=='ON'){
                data.sex="女";
            }else{
                data.sex="男";
            }
            debugger
            $.ajax({
                url:"<%=basePath%>userServlet?flag=update",
                type:"post",
                data:data,
                success:function(result){
                    if(result.code==0){
                        layer.alert("修改成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("不好意思，修改失败了...")
                    }
                }
            })
            return false;
        });


    });
</script>

</body>

</html>
```

#### 4.3.4 修改密码页面

```
<%@page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
  %>
<html>
<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
    <%--    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">--%>
    <%--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />--%>
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <input type="hidden" name="id" >
        <div class="layui-form-item">
            <label for="password" class="layui-form-label">
                <span class="x-red">*</span>请输入密码
            </label>
            <div class="layui-input-inline">
                <input type="password" id="password" name="password" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label for="password" class="layui-form-label">
                <span class="x-red">*</span>再次输入
            </label>
            <div class="layui-input-inline">
                <input type="password" id="password2" name="password2" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="updatePassword" lay-submit="">
                修改密码
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer'], function(){
        $ = layui.jquery;
        var form = layui.form
            ,layer = layui.layer;

        <%
           String id=request.getParameter("id");
        %>

        //监听提交
        form.on('submit(updatePassword)', function(data){
            /*
               1、获取输入框的值信息
               2、通过ajax请求向后端发送请求
               3、根据响应反馈信息提示，并刷新主页
             */
            var data=data.field;
            if(data.password!=data.password2){
                layer.msg("您输入的两次密码不一致...");
                return false;
            }
            debugger

            $.ajax({
                url:"<%=basePath%>userServlet?flag=updatePassword&id=<%=id%>",
                type:"post",
                data:data,
                success:function(result){
                    if(result.code==0){
                        layer.alert("修改密码成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("不好意思，修改失败了...")
                    }
                }
            })
            return false;
        });


    });
</script>

</body>

</html>
```

## 5、预定管理

1、 预定查询（高级查询 分页查询 在线导出 在线打印等）

2、添加预定信息（客户添加 管理员添加）

3、删除以及批量删除工作

4、修改预定信息（管理员操作）

5、在线审核功能 

### ![1641735026158](C:\Users\zhouk\AppData\Roaming\Typora\typora-user-images\1641735026158.png)5.1 后端接口提供

#### 5.1.1 model层类对象

```
package com.yanzhen.model;

import java.util.Date;

public class ReserveInfo {
    private Integer id;
    private Integer room_id;//房间编号
    private String id_card;//身份证号
    private String tel;
    private Date start_time;//开始时间
    private int counts;
    private Date end_time;//结束结束
    private String remark;
    private Integer is_pay;//是否付钱
    /*
        0:预定中 未审核  用于前端客户的预定
        1:审核通过  后端管理员审核 如是后端管理员添加默认审核通过
        2：退房
     */
    private Integer state;
    private Date create_time;
    private String create_author;
    private Date update_time;
    private String update_author;
    private String number;

    public String getNumber() {
        return number;
    }

    public void setNumber(String number) {
        this.number = number;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Integer getRoom_id() {
        return room_id;
    }

    public void setRoom_id(Integer room_id) {
        this.room_id = room_id;
    }

    public String getId_card() {
        return id_card;
    }

    public void setId_card(String id_card) {
        this.id_card = id_card;
    }

    public String getTel() {
        return tel;
    }

    public void setTel(String tel) {
        this.tel = tel;
    }

    public Date getStart_time() {
        return start_time;
    }

    public void setStart_time(Date start_time) {
        this.start_time = start_time;
    }

    public int getCounts() {
        return counts;
    }

    public void setCounts(int counts) {
        this.counts = counts;
    }

    public Date getEnd_time() {
        return end_time;
    }

    public void setEnd_time(Date end_time) {
        this.end_time = end_time;
    }

    public String getRemark() {
        return remark;
    }

    public void setRemark(String remark) {
        this.remark = remark;
    }

    public Integer getIs_pay() {
        return is_pay;
    }

    public void setIs_pay(Integer is_pay) {
        this.is_pay = is_pay;
    }

    public Integer getState() {
        return state;
    }

    public void setState(Integer state) {
        this.state = state;
    }

    public Date getCreate_time() {
        return create_time;
    }

    public void setCreate_time(Date create_time) {
        this.create_time = create_time;
    }

    public String getCreate_author() {
        return create_author;
    }

    public void setCreate_author(String create_author) {
        this.create_author = create_author;
    }

    public Date getUpdate_time() {
        return update_time;
    }

    public void setUpdate_time(Date update_time) {
        this.update_time = update_time;
    }

    public String getUpdate_author() {
        return update_author;
    }

    public void setUpdate_author(String update_author) {
        this.update_author = update_author;
    }
}

```

#### 5.1.2 dao层接口和实现

```
package com.yanzhen.dao;

import com.yanzhen.model.ReserveInfo;

import java.sql.SQLException;
import java.util.List;

public interface ReserveInfoDao {
    /**
     * 分页查询
     * @param startPage 开始页
     * @param limit 每页显示记录数
     * @param content 高级查询参数
     * @return
     * @throws SQLException
     */
    List<ReserveInfo> queryList(int startPage, int limit, String content) throws SQLException;

    /**
     * 获取总的记录数据
     */
    int getCounts(String content) throws SQLException;

    /**
     * 增加类型
     */
    boolean saveInfo(ReserveInfo reserveInfo);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    ReserveInfo queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(ReserveInfo reserveInfo);

    /**
     * 审核状态
     * 根据id修改状态
     */
     boolean updateStatusById(Integer status,Integer id);

}

```

实现

```
package com.yanzhen.dao.impl;

import com.yanzhen.dao.ReserveInfoDao;
import com.yanzhen.model.ReserveInfo;
import com.yanzhen.util.DbUtils;
import java.sql.SQLException;
import java.util.List;

public class ReserveInfoDaoImpl implements ReserveInfoDao {
    DbUtils utils=new DbUtils();
    @Override
    public List<ReserveInfo> queryList(int startPage, int limit, String content) throws SQLException {
        String sql="select info.* ,room.number   from reserve_info info " +
                " LEFT JOIN room_info room on room.id=info.room_id where  info.state !=2 ";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append( " and id_card like '"+content+"'");
        }
        sb.append(" order by id desc");
        sb.append(" limit "+startPage+","+limit );
        List<ReserveInfo> list=utils.list(ReserveInfo.class,sb.toString(),null);
        return list;
    }

    @Override
    public int getCounts(String content) throws SQLException {
        String sql="select info.* ,room.number   from reserve_info info " +
                " LEFT JOIN room_info room on room.id=info.room_id where  info.state !=2 ";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append( " and id_card like '"+content+"'");
        }
       return  utils.getCount(sb.toString());
    }

    @Override
    public boolean saveInfo(ReserveInfo info) {
        boolean bs=utils.save("insert into reserve_info (room_id,id_card,tel,counts," +
                " start_time,end_time,is_pay,state) values (?,?,?,?,?,?,?,?)",
                info.getRoom_id(),info.getId_card(),info.getTel(),info.getCounts(),
                info.getStart_time(),info.getEnd_time(),info.getIs_pay(),info.getState());
        return bs;
    }

    @Override
    public boolean deleteById(Integer id) {
        String sql="delete from reserve_info where id="+id;
        return utils.remove(sql,null);
    }

    @Override
    public ReserveInfo queryByID(Integer id) throws SQLException {
        String sql="select * from reserve_info where id="+id;
        ReserveInfo info=utils.query(ReserveInfo.class,sql,null);
        return info;
    }

    @Override
    public boolean updateInfo(ReserveInfo info) {
        boolean bs=utils.update("update reserve_info set tel=?," +
                " start_time=?," +
                " end_time=?,state=? where id="+info.getId(),
                 info.getTel(),info.getStart_time(),info.getEnd_time(),info.getState());
        return bs;
    }

    @Override
    public boolean updateStatusById(Integer status, Integer id) {
       boolean bs= utils.update("update reserve_info set state=? where id="+id,status);
       return bs;
    }
}

```

#### 5.1.3 service层

```
package com.yanzhen.service;

import com.yanzhen.model.ReserveInfo;
import com.yanzhen.model.UserInfo;
import com.yanzhen.util.PageBean;

import java.sql.SQLException;

public interface ReserveInfoService {
    /**
     * 分页查询
     */
    PageBean getPage(String page, String limit, String username) throws SQLException;


    /**
     * 增加类型
     */
    boolean saveInfo(ReserveInfo type);

    /**
     * 删除
     */
    boolean deleteById(Integer id) throws SQLException;

    /**
     * 根据id查询对象
     */
    ReserveInfo queryByID(Integer id) throws SQLException;

    /**
     * 修改提交操作
     */
    boolean updateInfo(ReserveInfo info);

    /**
     * 修改状态
     */
    boolean updateStatus(Integer status,Integer id);
}

```

实现

```
package com.yanzhen.service.impl;

import com.yanzhen.dao.ReserveInfoDao;
import com.yanzhen.dao.RoomInfoDao;
import com.yanzhen.dao.impl.ReserveInfoDaoImpl;
import com.yanzhen.dao.impl.RoomInfoDaoImpl;
import com.yanzhen.model.ReserveInfo;
import com.yanzhen.service.ReserveInfoService;
import com.yanzhen.util.PageBean;

import java.sql.SQLException;
import java.util.List;

public class ReserveInfoServiceImpl implements ReserveInfoService {
    ReserveInfoDao dao=new ReserveInfoDaoImpl();
    RoomInfoDao roomInfoDao=new RoomInfoDaoImpl();
    @Override
    public PageBean getPage(String page, String limit, String username) throws SQLException {
        //引入分页对象
        PageBean<ReserveInfo> pageBean=new PageBean<>();
        //当前页
        Integer page2=Integer.parseInt(page);
        //每页显示记录数
        Integer limit2=Integer.parseInt(limit);
        //起始记录数  类似
        int startPage=(page2-1)*pageBean.getPageCount();
        //总的记录数据
        int counts=dao.getCounts(username);
        //获取list  开始记录
        List<ReserveInfo> list= dao.queryList(startPage,limit2,username);
        //设置对象
        pageBean.setPageData(list);
        //总的数据
        pageBean.setTotalCount(counts);
        //总的页数
        pageBean.setTotalPage(counts/pageBean.getPageCount()+1);
        return pageBean;
    }

    @Override
    public boolean saveInfo(ReserveInfo type) {
        //在添加预定信息的时候需要更改房间的状态信息
        roomInfoDao.updateStatusById(1,type.getRoom_id());
        return dao.saveInfo(type);
    }

    @Override
    public boolean deleteById(Integer id) throws SQLException {
        //在添加预定信息的时候需要更改房间的状态信息
        Integer roomId=dao.queryByID(id).getRoom_id();
        roomInfoDao.updateStatusById(0,roomId);
        return dao.deleteById(id);
    }

    @Override
    public ReserveInfo queryByID(Integer id) throws SQLException {
        return dao.queryByID(id);
    }

    @Override
    public boolean updateInfo(ReserveInfo info) {
        return dao.updateInfo(info);
    }

    @Override
    public boolean updateStatus(Integer status, Integer id) {
        return dao.updateStatusById(status,id);
    }
}

```

#### 5.1.4 servlet 层

```
package com.yanzhen.controller;

import com.alibaba.fastjson.JSON;
import com.yanzhen.model.ReserveInfo;
import com.yanzhen.model.UserInfo;
import com.yanzhen.service.ReserveInfoService;
import com.yanzhen.service.impl.ReserveInfoServiceImpl;
import com.yanzhen.util.DateUtil;
import com.yanzhen.util.JsonObject;
import com.yanzhen.util.PageBean;
import com.yanzhen.util.R;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;
import java.text.ParseException;
import java.util.Arrays;
import java.util.List;

@WebServlet("/reserveServlet")
public class ReserveServlet extends HttpServlet {
    ReserveInfoService service=new ReserveInfoServiceImpl();
    @Override
    protected void service(HttpServletRequest req,
                           HttpServletResponse resp) throws ServletException, IOException {
        //接收前端传过来的功能标识
        String flag=req.getParameter("flag")==null?"":req.getParameter("flag");
        switch (flag){
            case "insert":
                ReserveInfo info= null;
                try {
                    info = getValues(req);
                } catch (ParseException e) {
                    e.printStackTrace();
                }
                service.saveInfo(info);
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;
            case "updateStatus":
                String id2=req.getParameter("id");
                String state=req.getParameter("state")==null?"1":req.getParameter("state");
                //如果是审核通过 默认为1
                service.updateStatus(Integer.parseInt(state),Integer.parseInt(id2));
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;
            case "delete":
                String ids=req.getParameter("ids");
                //把接收到的字符串转成集合
                List<String> idList= Arrays.asList(ids.split(","));
                for(String id:idList){
                    try {
                        service.deleteById(Integer.parseInt(ids));
                    } catch (SQLException throwables) {
                        throwables.printStackTrace();
                    }
                }
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;
            case "queryId":
                String id=req.getParameter("id");
                ReserveInfo info1= null;
                try {
                    info1 = service.queryByID(Integer.parseInt(id));
                } catch (SQLException throwables) {
                    throwables.printStackTrace();
                }
                req.setAttribute("info",info1);
                resp.setContentType("text/html;chartset=utf-8");
                req.getRequestDispatcher("admin/reserve/update.jsp").forward(req,resp);
                break;
            case "update":
                ReserveInfo roomInfo= null;
                try {
                    roomInfo = getValues(req);
                } catch (ParseException e) {
                    e.printStackTrace();
                }
                boolean bs=service.updateInfo(roomInfo);
                resp.setContentType("application/json;chartset=utf-8");
                String jsons2=JSON.toJSONString(R.fail("修改失败了..."));
                if(bs){
                    jsons2=JSON.toJSONString(R.ok());
                }
                resp.getWriter().print(jsons2);
                break;
            default:
                query(req,resp);
                break;
        }

    }




    /**
     * 根据前端传值获取对应的值信息，并把值信息封装到RoomInfo 对象中
     * @param req
     * @return
     */
    public ReserveInfo getValues(HttpServletRequest req) throws ParseException {
        //根据id判断是修改还新增，如修改id不为空
        ReserveInfo info=new ReserveInfo();
        String id=req.getParameter("id")==null?null:req.getParameter("id");
        if(id!=null){
            info.setId(Integer.parseInt(id));
        }
        String room_id=req.getParameter("roomId");
        String id_card=req.getParameter("idCard");
        String tel=req.getParameter("tel");
        String counts=req.getParameter("counts");
        String start_time=req.getParameter("startTime");
        String end_time=req.getParameter("endTime");
        String state=req.getParameter("state")==null?"0":req.getParameter("state");
        String is_pay=req.getParameter("isPay")==null?"0":req.getParameter("isPay");
        info.setRoom_id(Integer.parseInt(room_id));
        info.setId_card(id_card);
        info.setTel(tel);
        if(counts==null){
             counts="0";
        }
        info.setCounts(Integer.parseInt(counts));
        info.setStart_time(DateUtil.stringToDate(start_time));
        info.setEnd_time(DateUtil.stringToDate(end_time));
        info.setState(Integer.parseInt(state));
        info.setIs_pay(Integer.parseInt(is_pay));
        return info;
    }
    /**
     * 查询
     */
    public void query(HttpServletRequest req,
                      HttpServletResponse resp) throws ServletException, IOException {

        //接收前端的传值  当前页 每页显示记录数
        String currPage=req.getParameter("page");
        String limit=req.getParameter("limit");
        String content=req.getParameter("content")==null?null:req.getParameter("content");
        //判断
        if(currPage==null || "".equals(currPage.trim())){
            currPage="1";
        }

        if(limit==null || "".equals(limit.trim())){
            limit="10";
        }

        //通过service层接口拿到分页对象
        PageBean<ReserveInfo> pageBean=null;
        try {
            pageBean = service.getPage(currPage,limit,content);
        } catch (SQLException throwables) {
            throwables.printStackTrace();
        }

        //转到前端
        JsonObject object=new JsonObject();
        object.setCode(0);
        object.setMsg("");
        object.setCount(pageBean.getTotalCount());
        object.setData(pageBean.getPageData());

        resp.setContentType("application/json;chartset=utf-8");
        String jsons= JSON.toJSONString(object);
        resp.getWriter().print(jsons);
    }
}

```

### 5.2 页面设计

#### 5.2.1 主页

```
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
<html  class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>管理系统</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
<%--    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript"src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  --%>  <script src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>

    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <script>
        // 是否开启刷新记忆tab功能
        // var is_remember = false;
    </script>


    <style type="text/css">
        .laytable-cell-checkbox, .laytable-cell-numbers, .laytable-cell-radio, .laytable-cell-space {
            padding: 5px;
            text-align: center;
        }
    </style>
</head>

<body class="">

<div class="x-body">

    <div class="demoTable">
        身份证号：
        <div class="layui-inline">
            <input class="layui-input" name="id_card" id="id_card" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
    </div>

    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">批量删除</button>
            <button class="layui-btn" onclick="x_admin_show('在线预定','<%=basePath%>admin/reserve/add.jsp','750','600')"><i class="layui-icon"></i>添加</button>
        </div>
    </script>

    <script type="text/html" id="dateTpl">
<%--       没有时间时候自动显示当前日期内容
{{layui.util.toDateString(new Date(d.create_time).getTime(), "yyyy-MM-dd HH:mm:ss") }}--%>
        {{#
        if(d.start_time){}}
        {{layui.util.toDateString(new Date(d.start_time).getTime(), "yyyy-MM-dd HH:mm:ss") }}
        {{#}
        else{}}
        {{#}}}
    </script>
    <script type="text/html" id="dateTpl2">
        {{#
        if(d.end_time){}}
        {{layui.util.toDateString(new Date(d.end_time).getTime(), "yyyy-MM-dd HH:mm:ss") }}
        {{#}
        else{}}
        {{#}}}
    </script>

    <table class="layui-table" lay-data="{url:'<%=basePath%>reserveServlet',page:true,toolbar: '#toolbarDemo',id:'test'}" lay-filter="test">
        <thead>
        <tr>
            <th  class="checkbox" lay-data="{type:'checkbox'}">ID</th>
            <th lay-data="{field:'id_card', width:120}">身份证号</th>
            <th lay-data="{field:'tel', width:80}">电话</th>
            <th lay-data="{field:'number',  width: 100}">房间编号</th>
            <th lay-data="{field:'status', width:80,templet:function(res){
                      if(res.state==1){
                          return ' 预定成功'
                       }else {
                          return '待审核'
                       }
            } }">状态</th>
         <th lay-data="{field:'start_time',width:150,title:'入住时间',templet: '#dateTpl'}">入住时间</th>
            <th lay-data="{field:'end_time',width:150,title:'退房时间',templet: '#dateTpl2'}">预计退房时间</th>
<%--            <th lay-data="{field:'create_time',templet: '{layui.util.toDateString(d.create_time, 'yyyy-MM-dd') }'}">创建时间</th>--%>
            <th lay-data="{field:'create_author', edit: 'text',width:80}">创建人</th>
            <th lay-data="{title:'操作', toolbar: '#barDemo',minWidth: 150}">操作</th>
        </tr>
        </thead>
    </table>

</div>

<script type="text/html" id="barDemo">
    {{#
    if(d.state==0){ }}

    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="shenhe">审核</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>

    {{#}
    else{ }}
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
    {{#}}}
    </script>

<script>
    layui.use(['form', 'table'], function () {
        var form = layui.form,
            table = layui.table;
        var $ = layui.$, active = {
            reload: function(){
                var id_card = $('#id_card').val();
                //执行重载
                table.reload('test', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                        content:id_card
                    }
                }, 'data');
            }
        };

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

        /**
         * tool操作栏监听事件
         */
        table.on('tool(test)', function (obj) {
            var data=obj.data;
            debugger
            if (obj.event === 'edit') {  // 监听添加操作
                var index = layer.open({
                    title: '修改预定信息',
                    type: 2,
                    shade: 0.2,
                    shadeClose: true,
                    area: ['70%', '70%'],
                    content: '<%=basePath%>reserveServlet?flag=queryId&id='+data.id,
                });
                $(window).on("resize", function () {
                    layer.full(index);
                });
            } else if (obj.event === 'delete') {  // 监听删除操作
                layer.confirm('真的删除行么', function (index) {
                    //调用删除功能
                    deleteInfoByIds(data.id,index);
                    layer.close(index);
                });
            } else if (obj.event === 'shenhe') {  // 监听删除操作
                layer.confirm('要审核通过吗', function (index) {
                    updateStatus(data.id);
                    // layer.close(index);
                });
            }
        });



        /**
         * 获取选中记录的id信息
         */
        function getCheackId(data){
            var arr=new Array();
            for(var i=0;i<data.length;i++){
                arr.push(data[i].id);
            }
            //拼接id
            return arr.join(",");
        };

        /**
         * 审核
         */
        function updateStatus(ids){
            //向后台发送请求
            $.ajax({
                url: "<%=basePath%>reserveServlet?flag=updateStatus",
                type: "POST",
                data: {id: ids},
                success: function (result) {
                    if (result.code == 0) {//如果成功
                        layer.msg('审核成功', {
                            icon: 6,
                            time: 500
                        }, function () {
                            parent.window.location.reload();
                            var iframeIndex = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(iframeIndex);
                        });
                    }  else {
                        layer.msg("审核失败");
                    }
                }
            })
        };

        /**
         * 提交删除功能
         */
        function deleteInfoByIds(ids ,index){
            //向后台发送请求
            $.ajax({
                url: "<%=basePath%>reserveServlet?flag=delete",
                type: "POST",
                data: {ids: ids},
                success: function (result) {
                    if (result.code == 0) {//如果成功
                        layer.msg('删除成功', {
                            icon: 6,
                            time: 500
                        }, function () {
                            parent.window.location.reload();
                            var iframeIndex = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(iframeIndex);
                        });
                    } else {
                        layer.msg("删除失败");
                    }
                }
            })
        };

        //头工具栏事件
        table.on('toolbar(test)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            if(obj.event=='getCheckData'){
                var data = checkStatus.data;
                if(data.length==0){//如果没有选中信息
                    layer.msg("请选择要删除的记录信息");
                }else{
                    //获取记录信息的id集合
                    var ids=getCheackId(data);
                    layer.confirm('真的删除行么', function (index) {
                        //调用删除功能
                        deleteInfoByIds(ids,index);
                        layer.close(index);
                    });
                }
            }
        });
    });
</script>

</body>

</html>

```

#### 5.2.2 新增

```
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
   String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";

%>
<html  class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>管理系统</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript"src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
    <script src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>

    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <script>
        // 是否开启刷新记忆tab功能
        // var is_remember = false;
    </script>
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span>身份证号
            </label>
            <div class="layui-input-block">
                <input type="text" id="id_card" name="idCard" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span> 联系电话
            </label>
            <div class="layui-input-block">
                <input type="text" id="tel" name="tel" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span> 人数
            </label>
            <div class="layui-input-block">
                <input type="text" id="counts" name="counts" required=""
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span>房间编号
            </label>
            <div class="layui-input-block">
                <select name="roomId" id="typeId" lay-verify="required">
                    <option value="">请选择</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">入住时间</label>
            <div class="layui-input-block">
                <input type="text" name="startTime" class="layui-input" id="test" placeholder="yyyy-MM-dd HH:mm:ss">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">预计离开时间</label>
            <div class="layui-input-block">
                <input type="text"  name="endTime" class="layui-input" id="test2"
                       placeholder="yyyy-MM-dd HH:mm:ss">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">是否入住</label>
            <div class="layui-input-block">
                <input type="checkbox" checked="" name="state" lay-skin="switch" lay-filter="switchTest" lay-text="入住|预定">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">是否付费</label>
            <div class="layui-input-block">
                <input type="checkbox" checked="" name="isPay" lay-skin="switch" lay-filter="switchTest" lay-text="付费|未付费">
            </div>
        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="add" lay-submit="">
                在线预定
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer', 'layedit','laydate'], function(){
        $ = layui.jquery;
        var form = layui.form
            ,layer = layui.layer;
        laydate=layui.laydate;
        var form=layui.form,
            layedit=layui.layedit;
        var index1 = layedit.build('LAY_demo1', {
            tool: ['strong', 'italic', 'underline', 'del', '|', 'left', 'center', 'right'],
            height: 150
        });

        //时间选择器
        laydate.render({
            elem: '#test'
            ,type: 'datetime'
        });
        //时间选择器
        laydate.render({
            elem: '#test2'
            ,type: 'datetime'
        });


        //动态获取图书类型的数据
        $.get("<%=basePath%>roomServlet?flag=queryRoomListByStatus",{},function (data) {
            var list=data;
            var select=document.getElementById("typeId");
            if(list!=null|| list.size()>0){
                for(var c in list){
                    var option=document.createElement("option");
                    option.setAttribute("value",list[c].id);
                    option.innerText=list[c].number;
                    select.appendChild(option);
                }
            }
            form.render('select');
        },"json")




        //监听提交
        form.on('submit(add)', function(data){
            console.log(data);
            //发异步，把数据提交给php
            var data=data.field;
            if(data.state=='ON'){
                data.state=1;
            }else{
                data.state=0;
            }
            if(data.isPay=='ON'){
                data.isPay=1;
            }else{
                data.isPay=0;
            }

            debugger
            $.ajax({
                url:"<%=basePath%>reserveServlet?flag=insert",
                type:"post",
                data:data,
                success:function (result) {
                    debugger
                    //把字符串转json对象JSON.parse(result)
                    if(result.code==0){
                        layer.alert("增加成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("添加失败")
                    }
                }
            });
            return false;
        });
    });
</script>

</body>

</html>
```

#### 5.2.3 修改

```
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
<html  class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>管理系统</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript"src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
    <script src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>

    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <script>
        // 是否开启刷新记忆tab功能
        // var is_remember = false;
    </script>
</head>

<body>
<div class="x-body">
    <form class="layui-form" lay-filter="update" >
        <input type="hidden" name="id" value="${info.id}">
        <input type="hidden" id="roomId"  value="${info.room_id}">
        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span>身份证号
            </label>
            <div class="layui-input-block">
                <input type="text" id="id_card" name="idCard" value="${info.id_card}"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span> 联系电话
            </label>
            <div class="layui-input-block">
                <input type="text" id="tel" name="tel" required="" value="${info.tel}"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="x-red">*</span>房间编号
            </label>
            <div class="layui-input-block">
                <select name="roomId" id="typeId" lay-verify="required">
                    <!--
                       这里查询状态因都是未入住的，所以当前修改的找不到，后端可以加入方法实现

                    -->
                    <option value="">请选择</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">入住时间</label>
            <div class="layui-input-block">
                <input type="text" name="startTime" value="<fmt:formatDate value="${info.start_time}" pattern="yyyy-MM-dd HH:mm:ss" />" class="layui-input" id="test" placeholder="yyyy-MM-dd HH:mm:ss">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">预计离开时间</label>
            <div class="layui-input-block">
                <input type="text"  name="endTime" class="layui-input" id="test2"
                       placeholder="yyyy-MM-dd HH:mm:ss"
                       value="<fmt:formatDate value="${info.end_time}" pattern="yyyy-MM-dd HH:mm:ss"/> ">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">是否入住</label>
            <div class="layui-input-block">
                <input type="checkbox" <c:if test="${info.state==1}">checked </c:if> name="state" lay-skin="switch" lay-filter="switchTest" lay-text="入住|预定">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">是否付费</label>
            <div class="layui-input-block">
                <input type="checkbox" checked="" <c:if test="${info.is_pay==1}">checked </c:if> name="isPay" lay-skin="switch" lay-filter="switchTest" lay-text="付费|未付费">
            </div>
        </div>
        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="update" lay-submit="">
                修改预定信息
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer', 'layedit','laydate'], function(){
        $ = layui.jquery;
        var form = layui.form
            ,layer = layui.layer;
        laydate=layui.laydate;
        var form=layui.form,
            layedit=layui.layedit;
        var index1 = layedit.build('LAY_demo1', {
            tool: ['strong', 'italic', 'underline', 'del', '|', 'left', 'center', 'right'],
            height: 150
        });

        //时间选择器
        laydate.render({
            elem: '#test'
            ,type: 'datetime'
        });
        //时间选择器
        laydate.render({
            elem: '#test2'
            ,type: 'datetime'
        });


        //动态获取图书类型的数据
        var values=document.getElementById("roomId").value;
       
        $.get("<%=basePath%>roomServlet?flag=queryRoomListByStatus",{},function (data) {
            var list=data;
            var select=document.getElementById("typeId");
            if(list!=null|| list.size()>0){
                for(var c in list){
                    var option=document.createElement("option");
                    option.setAttribute("value",list[c].id);
                    option.innerText=list[c].number;
                    select.appendChild(option);
                    if(list[c].id==values){
                        option.setAttribute("selected","selected");
                        layui.form.render('select');
                    }
                }
            }
            form.render('select');
        },"json")




        //监听提交
        form.on('submit(update)', function(data){
            console.log(data);
            //发异步，把数据提交给php
            var data=data.field;
            if(data.state=='ON'){
                data.state=1;
            }else{
                data.state=0;
            }
            if(data.isPay=='ON'){
                data.isPay=1;
            }else{
                data.isPay=0;
            }

            $.ajax({
                url:"<%=basePath%>reserveServlet?flag=update",
                type:"post",
                data:data,
                success:function (result) {
                    if(result.code==0){
                        layer.alert("修改成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("添加失败")
                    }
                }
            });
            return false;
        });
    });
</script>

</body>

</html>
```

注意点：如果时间组件出现乱码可以通过更改tomcat编码集处理

## 6、退房管理

1、退房信息查询

​      主要用于查询退房信息  (查询是  当前入住的房间  房间类型  退房信息)

2、在线退房

​      退房时间  (预定信息  退房时间   备注)

​      1、房间状态改成未入住

​       2、预定表中的状态改成退房

​       3、退房记录的添加

3、查看功能（根据退房id 查询房间具体信息  ）

4、删除退房信息

![1641992828450](C:\Users\zhouk\AppData\Roaming\Typora\typora-user-images\1641992828450.png)

### 6.1 后端接口提供

#### 6.1.1 model层类对象

```
package com.yanzhen.model;

import java.util.Date;

public class CheckOutRoom extends ReserveInfo{
    private Integer outId;
    private Integer reserveId;
    private Date outTime;
    private String  author;
    private String remark2;//备注信息 退房中的备注
    private String type_name;

     get  set 方法
}

```

#### 6.1.2 dao层接口和实现

```
package com.yanzhen.dao;

import com.yanzhen.model.CheckOutRoom;

import java.sql.SQLException;
import java.util.List;

public interface CheckOutDao {
    List<CheckOutRoom> queryList(int startPage, int limit, String content) throws SQLException;

    /**
     * 获取总的记录数据
     */
    int getCounts(String content) throws SQLException;

    /**
     * 增加
     */
    boolean saveInfo(CheckOutRoom type);

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    CheckOutRoom queryByID(Integer id) throws SQLException;
}

```



实现

```
package com.yanzhen.dao.impl;

import com.yanzhen.dao.CheckOutDao;
import com.yanzhen.model.CheckOutRoom;
import com.yanzhen.model.RoomType;
import com.yanzhen.util.DateUtil;
import com.yanzhen.util.DbUtils;
import com.yanzhen.util.JdbcUtil;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

public class CheckOutDaoImpl implements CheckOutDao {
    DbUtils utils=new DbUtils();

    @Override
    public List<CheckOutRoom> queryList(int startPage, int limit, String content) throws SQLException {
        List<CheckOutRoom> list=new ArrayList<CheckOutRoom>();
        String sql="select rinfo.number,info.id,info.id_card,info.tel,info.start_time,info.state,\n" +
                " info.is_pay,type.type_name ,room.out_time,room.remark as remark2 " +
                " from reserve_info info LEFT JOIN room_type type on type.id=info.room_id " +
                " LEFT JOIN room_info rinfo on rinfo.id=info.room_id " +
                " LEFT JOIN cheak_out_room room on room.reserve_id=info.id  " +
                " where info.state in (1,2)";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append(" and id_card like '"+content+"'");
        }
        sb.append(" limit "+startPage+","+limit);
        ResultSet rs= JdbcUtil.querySql(sb.toString());
        while(rs.next()){
            CheckOutRoom cinfo=new CheckOutRoom();
            cinfo.setNumber(rs.getString("number"));
            cinfo.setId(rs.getInt("id"));
            cinfo.setId_card(rs.getString("id_card"));
            cinfo.setTel(rs.getString("tel"));
            cinfo.setStart_time(rs.getDate("start_time"));
            cinfo.setState(rs.getInt("state"));
            cinfo.setIs_pay(rs.getInt("is_pay"));
            cinfo.setType_name(rs.getString("type_name"));
            cinfo.setOutTime(rs.getDate("out_time"));
            cinfo.setRemark2(rs.getString("remark2"));
            list.add(cinfo);
        }
        return list;
    }

    @Override
    public int getCounts(String content) throws SQLException {
        String sql="select rinfo.number,info.id,info.id_card,info.tel,info.start_time,info.state,\n" +
                " info.is_pay,type.type_name ,room.out_time,room.remark as remark2 " +
                " from reserve_info info LEFT JOIN room_type type on type.id=info.room_id " +
                " LEFT JOIN room_info rinfo on rinfo.id=info.room_id " +
                " LEFT JOIN cheak_out_room room on room.reserve_id=info.id  " +
                " where info.state in (1,2)";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append(" and id_card like '"+content+"'");
        }
        int num=utils.getCount(sql);
        return num;
    }

    @Override
    public boolean saveInfo(CheckOutRoom type) {
        String date= DateUtil.dateChangeString(new Date());
        String sql="insert into cheak_out_room (reserve_id,out_time,author,remark)" +
                " values("+type.getReserveId()+",'"+date+"','"+type.getAuthor()+"'," +
                " '"+type.getRemark2()+"')";
        int num= JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(num>0){
            return true;
        }
        return false;
    }

    @Override
    public boolean deleteById(Integer id) {
        String sql="delete from cheak_out_room where id="+id;
        int num= JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(num>0){
            return true;
        }
        return false;
    }

    @Override
    public CheckOutRoom queryByID(Integer id) throws SQLException {
        String sql="select rinfo.number,info.id,info.id_card,info.tel,info.start_time,info.state,\n" +
                " info.is_pay,type.type_name ,room.out_time,room.remark as remark2 " +
                " from reserve_info info LEFT JOIN room_type type on type.id=info.room_id " +
                " LEFT JOIN room_info rinfo on rinfo.id=info.room_id " +
                " LEFT JOIN cheak_out_room room on room.reserve_id=info.id  " +
                " where info.state in (1,2) and info.id="+id;
        ResultSet rs= JdbcUtil.querySql(sql);
        CheckOutRoom cinfo=new CheckOutRoom();
        while(rs.next()){
            cinfo.setNumber(rs.getString("number"));
            cinfo.setId(rs.getInt("id"));
            cinfo.setId_card(rs.getString("id_card"));
            cinfo.setTel(rs.getString("tel"));
            cinfo.setStart_time(rs.getDate("start_time"));
            cinfo.setState(rs.getInt("state"));
            cinfo.setIs_pay(rs.getInt("is_pay"));
            cinfo.setType_name(rs.getString("type_name"));
            cinfo.setOutTime(rs.getDate("out_time"));
            cinfo.setRemark2(rs.getString("remark2"));
        }
        return cinfo;
    }
}

```

#### 6.1.3 service层

```
package com.yanzhen.service;

import com.yanzhen.model.CheckOutRoom;
import com.yanzhen.model.RoomType;
import com.yanzhen.util.PageBean;

import java.sql.SQLException;

public interface CheckOutService {

    /**
     * 分页查询
     */
    PageBean getPage(String page, String limit, String content) throws SQLException;

    /**
     * 增加
     */
    boolean saveInfo(CheckOutRoom outRoom) throws SQLException;

    /**
     * 删除
     */
    boolean deleteById(Integer id);

    /**
     * 根据id查询对象
     */
    CheckOutRoom queryByID(Integer id) throws SQLException;
}

```

实现

```
package com.yanzhen.service.impl;

import com.yanzhen.dao.CheckOutDao;
import com.yanzhen.dao.ReserveInfoDao;
import com.yanzhen.dao.RoomInfoDao;
import com.yanzhen.dao.impl.CheckOutDaoImpl;
import com.yanzhen.dao.impl.ReserveInfoDaoImpl;
import com.yanzhen.dao.impl.RoomInfoDaoImpl;
import com.yanzhen.model.CheckOutRoom;
import com.yanzhen.model.ReserveInfo;
import com.yanzhen.model.RoomType;
import com.yanzhen.service.CheckOutService;
import com.yanzhen.util.PageBean;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

public class CheckOutServiceImpl implements CheckOutService {
    CheckOutDao dao=new CheckOutDaoImpl();
    //创建类对象
    RoomInfoDao roomInfoDao=new RoomInfoDaoImpl();
    //引入 预定对象dao
    ReserveInfoDao reserveInfoDao=new ReserveInfoDaoImpl();
    @Override
    public PageBean getPage(String page, String limit, String content) throws SQLException {
        //引入分页对象
        PageBean<CheckOutRoom> pageBean=new PageBean<>();
        //当前页
        Integer page2=Integer.parseInt(page);
        //每页显示记录数
        Integer limit2=Integer.parseInt(limit);
        //起始记录数  类似
        int startPage=(page2-1)*pageBean.getPageCount();
        //总的记录数据
        int counts=dao.getCounts(content);
        //获取list  开始记录
        List<CheckOutRoom> list= dao.queryList(startPage,limit2,content);
        //设置对象
        pageBean.setPageData(list);
        //总的数据
        pageBean.setTotalCount(counts);
        //总的页数
        pageBean.setTotalPage(counts/pageBean.getPageCount()+1);
        return pageBean;
    }

    @Override
    public boolean saveInfo(CheckOutRoom outRoom) throws SQLException {
        /*
          1、退房信息添加
          2、房间状态的改变
          3、预定状态的改变
         */
        boolean  bs=dao.saveInfo(outRoom);
        //根据预定信息的id查询房间的id
        ReserveInfo reserveInfo=reserveInfoDao.queryByID(outRoom.getReserveId());
        //房间状态的改变  根据id改变房间状态
        roomInfoDao.updateStatusById(0,reserveInfo.getRoom_id());
        //预定状态的改变
        reserveInfoDao.updateStatusById(2,reserveInfo.getId());
        if(bs){
            return true;
        }
        return false;
    }

    @Override
    public boolean deleteById(Integer id) {
        return dao.deleteById(id);

    }

    @Override
    public CheckOutRoom queryByID(Integer id) throws SQLException {
        return dao.queryByID(id);
    }
}

```

#### 6.1.4 servlet层

```
package com.yanzhen.controller;

import com.alibaba.fastjson.JSON;
import com.yanzhen.model.CheckOutRoom;
import com.yanzhen.model.RoomType;
import com.yanzhen.service.CheckOutService;
import com.yanzhen.service.impl.CheckOutServiceImpl;
import com.yanzhen.util.JsonObject;
import com.yanzhen.util.PageBean;
import com.yanzhen.util.R;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;
import java.util.Arrays;
import java.util.List;

@WebServlet("/checkOutServlet")
public class CheckOutServlet extends HttpServlet {

    CheckOutService service=new CheckOutServiceImpl();

    @Override
    protected void service(HttpServletRequest req,
                           HttpServletResponse resp) throws ServletException, IOException {
        String flag=req.getParameter("flag")==null?"":req.getParameter("flag");
        switch (flag){
            case "insert":
                String remark=req.getParameter("remark");
                String resID=req.getParameter("resID");//预定id
                String author="admin";//后续有了登录信息后使用登录用户名称
                CheckOutRoom checkOutRoom=new CheckOutRoom();
                checkOutRoom.setReserveId(Integer.parseInt(resID));
                checkOutRoom.setRemark2(remark);
                checkOutRoom.setAuthor(author);
                boolean bs= false;
                try {
                    bs = service.saveInfo(checkOutRoom);
                } catch (SQLException throwables) {
                    throwables.printStackTrace();
                }
                resp.setContentType("application/json;chartset=utf-8");
                String jsons=JSON.toJSONString(R.fail("退房失败了..."));
                if(bs){
                    jsons=JSON.toJSONString(R.ok());
                }
                resp.getWriter().print(jsons);
                break;
            case "delete":
                String ids=req.getParameter("ids");
                //把接收到的字符串转成集合
                List<String> idList= Arrays.asList(ids.split(","));
                for(String id:idList){
                    service.deleteById(Integer.parseInt(id));
                }
                resp.setContentType("application/json;chartset=utf-8");
                resp.getWriter().print(JSON.toJSONString(R.ok()));
                break;

            case "queryId":
                String id=req.getParameter("id");
                try {
                    CheckOutRoom info= service.queryByID(Integer.parseInt(id));
                    resp.setContentType("application/json;chartset=utf-8");
                    resp.getWriter().print(JSON.toJSONString(info));
                } catch (SQLException throwables) {
                    throwables.printStackTrace();
                }
                break;
            default:
                queryList(req,resp);
                break;
        }


    }


    /**
     * 分页查询
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    public void queryList(HttpServletRequest req,
                          HttpServletResponse resp) throws ServletException, IOException {
        //接收前端的传值  当前页 每页显示记录数
        String currPage=req.getParameter("page");
        String limit=req.getParameter("limit");
        String content=req.getParameter("content")==null?null:req.getParameter("content");
        //判断
        if(currPage==null || "".equals(currPage.trim())){
            currPage="1";
        }

        if(limit==null || "".equals(limit.trim())){
            limit="10";
        }

        //通过service层接口拿到分页对象
        PageBean<CheckOutRoom> pageBean=null;
        try {
            pageBean = service.getPage(currPage,limit,content);
        } catch (SQLException throwables) {
            throwables.printStackTrace();
        }
        //转到前端
        JsonObject object=new JsonObject();
        object.setCode(0);
        object.setMsg("");
        object.setCount(pageBean.getTotalCount());
        object.setData(pageBean.getPageData());

        resp.setContentType("application/json;chartset=utf-8");
        String jsons= JSON.toJSONString(object);
        resp.getWriter().print(jsons);
    }
}

```

### 6.2 前端页面

#### 6.2.1 主页 （分页查询  查询  高级查询）

```
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
<html  class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>管理系统</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
<%--    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript"src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  --%>  <script src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>

    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <script>
        // 是否开启刷新记忆tab功能
        // var is_remember = false;
    </script>


    <style type="text/css">
        .laytable-cell-checkbox, .laytable-cell-numbers, .laytable-cell-radio, .laytable-cell-space {
            padding: 5px;
            text-align: center;
        }
    </style>
</head>

<body class="">

<div class="x-body">

    <div class="demoTable">
        身份证号：
        <div class="layui-inline">
            <input class="layui-input" name="id_card" id="id_card" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
    </div>

    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">批量删除</button>
        </div>
    </script>

    <script type="text/html" id="dateTpl">
    {{#
        if(d.start_time){}}
        {{layui.util.toDateString(new Date(d.start_time).getTime(), "yyyy-MM-dd HH:mm:ss") }}
        {{#}
        else{}}
        {{#}}}
    </script>
    <script type="text/html" id="dateTpl2">
        {{#
        if(d.outTime){}}
        {{layui.util.toDateString(new Date(d.outTime).getTime(), "yyyy-MM-dd HH:mm:ss") }}
        {{#}
        else{}}
        {{#}}}
    </script>

    <table class="layui-table" lay-data="{url:'<%=basePath%>checkOutServlet',page:true,toolbar: '#toolbarDemo',id:'test'}" lay-filter="test">
        <thead>
        <tr>
            <th  class="checkbox" lay-data="{type:'checkbox'}">ID</th>
            <th lay-data="{field:'number',  width: 100}">房间编号</th>
            <th lay-data="{field:'id_card', width:120}">身份证号</th>
            <th lay-data="{field:'type_name', width:120}">房间类型</th>
            <th lay-data="{field:'tel', width:80}">电话</th>
            <th lay-data="{field:'status', width:80,templet:function(res){
                      if(res.state==1){
                          return '入住中'
                       }else {
                          return '已退房'
                       }
            } }">状态</th>
         <th lay-data="{field:'start_time',width:150,title:'入住时间',templet: '#dateTpl'}">入住时间</th>
            <th lay-data="{field:'outTime',width:150,title:'退房时间',templet: '#dateTpl2'}">退房时间</th>
<%--            <th lay-data="{field:'create_author', edit: 'text',width:80}">创建人</th>--%>
            <th lay-data="{title:'操作', toolbar: '#barDemo',minWidth: 150}">操作</th>
        </tr>
        </thead>
    </table>

</div>

<script type="text/html" id="barDemo">
    {{#
    if(d.state==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="edit">退房</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
    {{#}
    else{ }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="edit">退房详情</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
    {{#}}}
    </script>

<script>
    layui.use(['form', 'table'], function () {
        var form = layui.form,
            table = layui.table;
        var $ = layui.$, active = {
            reload: function(){
                var id_card = $('#id_card').val();
                //执行重载
                table.reload('test', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                        content:id_card
                    }
                }, 'data');
            }
        };

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

        /**
         * tool操作栏监听事件
         */
        table.on('tool(test)', function (obj) {
            var data=obj.data;
            debugger
            if (obj.event === 'edit') {  // 监听添加操作
                var index = layer.open({
                    title: '在线退房',
                    type: 2,
                    shade: 0.2,
                    shadeClose: true,
                    area: ['70%', '70%'],
                    content: '<%=basePath%>admin/check/add.jsp?id='+data.id,
                });
                $(window).on("resize", function () {
                    layer.full(index);
                });
            } else if (obj.event === 'delete') {  // 监听删除操作
                layer.confirm('真的删除行么', function (index) {
                    //调用删除功能
                    deleteInfoByIds(data.id,index);
                    layer.close(index);
                });
            } else if (obj.event === 'shenhe') {  // 监听删除操作
                layer.confirm('要审核通过吗', function (index) {
                    updateStatus(data.id);
                    // layer.close(index);
                });
            }
        });



        /**
         * 获取选中记录的id信息
         */
        function getCheackId(data){
            var arr=new Array();
            for(var i=0;i<data.length;i++){
                arr.push(data[i].id);
            }
            //拼接id
            return arr.join(",");
        };


        /**
         * 提交删除功能
         */
        function deleteInfoByIds(ids ,index){
            //向后台发送请求
            $.ajax({
                url: "<%=basePath%>checkOutServlet?flag=delete",
                type: "POST",
                data: {ids: ids},
                success: function (result) {
                    if (result.code == 0) {//如果成功
                        layer.msg('删除成功', {
                            icon: 6,
                            time: 500
                        }, function () {
                            parent.window.location.reload();
                            var iframeIndex = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(iframeIndex);
                        });
                    } else {
                        layer.msg("删除失败");
                    }
                }
            })
        };

        //头工具栏事件
        table.on('toolbar(test)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            if(obj.event=='getCheckData'){
                var data = checkStatus.data;
                if(data.length==0){//如果没有选中信息
                    layer.msg("请选择要删除的记录信息");
                }else{
                    //获取记录信息的id集合
                    var ids=getCheackId(data);
                    layer.confirm('真的删除行么', function (index) {
                        //调用删除功能
                        deleteInfoByIds(ids,index);
                        layer.close(index);
                    });
                }
            }
        });
    });
</script>

</body>

</html>

```

#### 6.2.2 退房页面

```
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%String path=request.getContextPath();
   String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";

%>
<html  class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>管理系统</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript"src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
    <script src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>

    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <script>
        // 是否开启刷新记忆tab功能
        // var is_remember = false;
    </script>
</head>

<body>
<div class="x-body">
    <form class="layui-form">
        <div class="layui-form-item">
            <label for="L_pass" class="layui-form-label">
                <span class="x-red">*</span>退房备注信息
            </label>
            <div class="layui-input-inline">
                <input type="text" id="L_pass" name="remark" required=""
                       autocomplete="off" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item">
            <label  class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="add" lay-submit="">
                在线退房
            </button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer', 'layedit','laydate'], function(){
        $ = layui.jquery;
        var form = layui.form
            ,layer = layui.layer;
        <%
             String resID=request.getParameter("id");
         %>
        //监听提交
        form.on('submit(add)', function(data){
            debugger
            //发异步
            var data=data.field;
            data.resID=<%=resID%>;
            $.ajax({
                url:"<%=basePath%>checkOutServlet?flag=insert",
                type:"post",
                data:data,
                success:function (result) {
                    debugger
                    //把字符串转json对象JSON.parse(result)
                    if(result.code==0){
                        layer.alert("退房成功", {icon: 6},function () {
                            //关闭当前frame
                            x_admin_close();
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    }else{
                        layer.msg("退房失败")
                    }
                }
            });
            return false;
        });
    });
</script>

</body>

</html>
```



## 7、评论管理

需求：

   1、评论信息查询    高级查询

   2、删除以及批量删除



### 7.1 后端接口

#### 7.1.1 model

```
package com.yanzhen.model;

import java.util.Date;

public class CommentInfo {
    private Integer id;
    private Integer   roomId;
    private Date commentTime;
    private String   username;
    private String email;
    private String    remark;
    //添加额外字段  房间的编号
    private String number;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Integer getRoomId() {
        return roomId;
    }

    public void setRoomId(Integer roomId) {
        this.roomId = roomId;
    }

    public Date getCommentTime() {
        return commentTime;
    }

    public void setCommentTime(Date commentTime) {
        this.commentTime = commentTime;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getRemark() {
        return remark;
    }

    public void setRemark(String remark) {
        this.remark = remark;
    }

    public String getNumber() {
        return number;
    }

    public void setNumber(String number) {
        this.number = number;
    }
}

```

#### 7.1.2 dao 层接口和实现

```
package com.yanzhen.dao;

import com.yanzhen.model.CommentInfo;
import com.yanzhen.model.UserInfo;

import java.sql.SQLException;
import java.util.List;

public interface CommentInfoDao {

    List<CommentInfo> queryList(int startPage, int limit, String content) throws SQLException;

    /**
     * 获取总的记录数据
     */
    int getCounts(String content) throws SQLException;



    /**
     * 删除
     */
    boolean deleteById(Integer id);
}

```

实现

```
package com.yanzhen.dao.impl;

import com.yanzhen.dao.CommentInfoDao;
import com.yanzhen.model.CommentInfo;
import com.yanzhen.util.DbUtils;
import com.yanzhen.util.JdbcUtil;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

public class CommentInfoDaoImpl implements CommentInfoDao {

    @Override
    public List<CommentInfo> queryList(int startPage, int limit, String content) throws SQLException {
        List<CommentInfo> list=new ArrayList<>();
        String sql="select com.*,info.number from room_comment com " +
                " LEFT JOIN room_info info on info.id=com.room_id where 1=1 ";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append( " and number like '"+content+"'");
        }
        sb.append(" limit "+startPage+","+limit);
        ResultSet rs=JdbcUtil.querySql(sb.toString());
        while(rs.next()){
            CommentInfo info=new CommentInfo();
            info.setId(rs.getInt("id"));
            info.setCommentTime(rs.getDate("comment_time"));
            info.setEmail(rs.getString("email"));
            info.setNumber(rs.getString("number"));
            info.setRemark(rs.getString("remark"));
            info.setRoomId(rs.getInt("room_id"));
            info.setUsername(rs.getString("username"));
            list.add(info);
        }
        return  list;
    }

    @Override
    public int getCounts(String content) throws SQLException {
        List<CommentInfo> list=new ArrayList<>();
        String sql="select com.*,info.number from room_comment com " +
                " LEFT JOIN room_info info on info.id=com.room_id where 1=1 ";
        StringBuffer sb=new StringBuffer(sql);
        if(content!=null){
            content="%"+content+"%";
            sb.append( " and number like '"+content+"'");
        }
        int num=new DbUtils().getCount(sb.toString());
        return num;
    }

    @Override
    public boolean deleteById(Integer id) {
        String sql="delete from room_comment where id="+id;
        int num=JdbcUtil.insertOrUpdateOrDeleteInfo(sql);
        if(num>0){
            return true;
        }
        return false;
    }
}

```

#### 7.1.3 service接口

```
package com.yanzhen.service;

import com.yanzhen.util.PageBean;

import java.sql.SQLException;

public interface CommentInfoService {

    /**
     * 分页查询
     */
    PageBean getPage(String page, String limit, String username) throws SQLException;

    /**
     * 删除
     */
    boolean deleteById(Integer id);
}

```

实现

```
package com.yanzhen.service.impl;

import com.yanzhen.dao.CommentInfoDao;
import com.yanzhen.dao.impl.CommentInfoDaoImpl;
import com.yanzhen.model.CommentInfo;
import com.yanzhen.model.UserInfo;
import com.yanzhen.service.CommentInfoService;
import com.yanzhen.util.PageBean;

import java.sql.SQLException;
import java.util.List;

public class CommentInfoServiceImpl implements CommentInfoService {
    CommentInfoDao dao=new CommentInfoDaoImpl();
    @Override
    public PageBean getPage(String page, String limit, String username) throws SQLException {
        //引入分页对象
        PageBean<CommentInfo> pageBean=new PageBean<>();
        //当前页
        Integer page2=Integer.parseInt(page);
        //每页显示记录数
        Integer limit2=Integer.parseInt(limit);
        //起始记录数  类似
        int startPage=(page2-1)*pageBean.getPageCount();
        //总的记录数据
        int counts=dao.getCounts(username);
        //获取list  开始记录
        List<CommentInfo> list= dao.queryList(startPage,limit2,username);
        //设置对象
        pageBean.setPageData(list);
        //总的数据
        pageBean.setTotalCount(counts);
        //总的页数
        pageBean.setTotalPage(counts/pageBean.getPageCount()+1);
        return pageBean;
    }

    @Override
    public boolean deleteById(Integer id) {
        return dao.deleteById(id);
    }
}

```

### 7.2 前端页面

```
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%
    String path=request.getContextPath();
    String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
<html  class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>管理系统</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="<%=basePath%>admin/css/font.css">
    <link rel="stylesheet" href="<%=basePath%>admin/css/xadmin.css">
<%--    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript"src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  --%>  <script src="<%=basePath%>admin/lib/layui/layui.js" charset="utf-8"></script>

    <script type="text/javascript" src="<%=basePath%>admin/js/xadmin.js"></script>
    <script type="text/javascript" src="<%=basePath%>admin/js/cookie.js"></script>
    <script>
        // 是否开启刷新记忆tab功能
        // var is_remember = false;
    </script>


    <style type="text/css">
        .laytable-cell-checkbox, .laytable-cell-numbers, .laytable-cell-radio, .laytable-cell-space {
            padding: 5px;
            text-align: center;
        }
    </style>
</head>

<body class="">

<div class="x-body">

    <div class="demoTable">
         房间编号：
        <div class="layui-inline">
            <input class="layui-input" name="number" id="number" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
    </div>

    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">批量删除</button>
        </div>
    </script>

    <script type="text/html" id="dateTpl">
       {{#
        if(d.commentTime){}}
           {{layui.util.toDateString(new Date(d.commentTime).getTime(), "yyyy-MM-dd HH:mm:ss") }}
        {{#}
        else{}}
        {{#}}}
    </script>


    <table class="layui-table" lay-data="{url:'<%=basePath%>commentServlet',page:true,toolbar: '#toolbarDemo',id:'test'}" lay-filter="test">
        <thead>
        <tr>
            <th  class="checkbox" lay-data="{type:'checkbox'}">ID</th>
            <th lay-data="{field:'number',  width: 100}">房间编号</th>
            <th lay-data="{field:'username', width:120}">用户名</th>
            <th lay-data="{field:'email', width:120}">邮箱</th>
           <th lay-data="{field:'commentTime',width:150,title:'评论时间',templet: '#dateTpl'}">入住时间</th>
            <th lay-data="{field:'remark', width:120}">内容</th>
            <th lay-data="{title:'操作', toolbar: '#barDemo',minWidth: 150}">操作</th>
        </tr>
        </thead>
    </table>

</div>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
</script>

<script>
    layui.use(['form', 'table'], function () {
        var form = layui.form,
            table = layui.table;
        var $ = layui.$, active = {
            reload: function(){
                var number = $('#number').val();
                //执行重载
                table.reload('test', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                        content:number
                    }
                }, 'data');
            }
        };

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

        /**
         * tool操作栏监听事件
         */
        table.on('tool(test)', function (obj) {
            var data=obj.data;
            debugger
           if (obj.event === 'delete') {  // 监听删除操作
                layer.confirm('真的删除行么', function (index) {
                    //调用删除功能
                    deleteInfoByIds(data.id,index);
                    layer.close(index);
                });
            }
        });



        /**
         * 获取选中记录的id信息
         */
        function getCheackId(data){
            var arr=new Array();
            for(var i=0;i<data.length;i++){
                arr.push(data[i].id);
            }
            //拼接id
            return arr.join(",");
        };


        /**
         * 提交删除功能
         */
        function deleteInfoByIds(ids ,index){
            //向后台发送请求
            $.ajax({
                url: "<%=basePath%>commentServlet?flag=delete",
                type: "POST",
                data: {ids: ids},
                success: function (result) {
                    if (result.code == 0) {//如果成功
                        layer.msg('删除成功', {
                            icon: 6,
                            time: 500
                        }, function () {
                            parent.window.location.reload();
                            var iframeIndex = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(iframeIndex);
                        });
                    } else {
                        layer.msg("删除失败");
                    }
                }
            })
        };

        //头工具栏事件
        table.on('toolbar(test)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            if(obj.event=='getCheckData'){
                var data = checkStatus.data;
                if(data.length==0){//如果没有选中信息
                    layer.msg("请选择要删除的记录信息");
                }else{
                    //获取记录信息的id集合
                    var ids=getCheackId(data);
                    layer.confirm('真的删除行么', function (index) {
                        //调用删除功能
                        deleteInfoByIds(ids,index);
                        layer.close(index);
                    });
                }
            }
        });
    });
</script>

</body>

</html>

```

